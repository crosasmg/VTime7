'---------------------------------------------------------------------------------------------------
' <generated>
'     This code was generated by Form Designer v7.3.34.1 at 2020-01-17 02:27:05 p. m. model release 2, Form Generator v1.0.37.30
'     
'     Changes to this file may cause incorrect behavior and will be lost if the code is regenerated.
' </generated>
'---------------------------------------------------------------------------------------------------
      
#Region "using"

Imports System.Data
Imports System.Globalization
Imports System.Runtime.Serialization
Imports System.Web.Script.Services
Imports System.Web.Services
Imports InMotionGIT.Common.Helpers
Imports InMotionGIT.Common.Proxy
Imports InMotionGIT.FrontOffice.Support

#End Region

Namespace dli.forms

    Public Class HT5CambioCorreoClientesDemoActions
        Inherits System.Web.UI.Page

#Region "Actions Methods"

       <WebMethod(EnableSession:=True)>
        Public Shared Function Initialization(id As String, urlid As String, fromid As String) As InMotionGIT.FrontOffice.Support.DataType.ServerActionResult
            
            Dim instance As New EntryData With {.InstanceFormId = id}
            Dim resultData As New InMotionGIT.FrontOffice.Support.DataType.ServerActionResult
            Dim currentAction As String = String.Empty
            
            Dim HT5CambioCorreoClientesDemoParametersInstance As HT5CambioCorreoClientesDemoParameters = Nothing

            
            Try
                InMotionGIT.FASI.Support.Authentication.AuthorizationProcess("EASE1")
                
                If id.IsEmpty AndAlso urlid.IsEmpty Then
                    instance.InstanceFormId = System.Guid.NewGuid().ToString
                    
                    With instance

                    End With                
                    
                    HT5CambioCorreoClientesDemoParametersInstance = EntryDataToClass(HT5CambioCorreoClientesDemoParametersInstance, instance)
                    SetDefaultValuesFromQueryString(HT5CambioCorreoClientesDemoParametersInstance)
                    
                    If fromid.IsNotEmpty Then
                        GetTransferParameters(HT5CambioCorreoClientesDemoParametersInstance, fromid)
                        ValidateParametersInstance(HT5CambioCorreoClientesDemoParametersInstance)
                    End If
                Else       
                    instance.InstanceFormId = id.IfEmpty(urlid)
                    HT5CambioCorreoClientesDemoParametersInstance = RetrieveFormInformationFromSession(instance.InstanceFormId)
         
                    If IsNothing(HT5CambioCorreoClientesDemoParametersInstance) then
                        HT5CambioCorreoClientesDemoParametersInstance = EntryDataToClass(HT5CambioCorreoClientesDemoParametersInstance, instance)                        
                    End If
                    
                    SetDefaultValuesFromQueryString(HT5CambioCorreoClientesDemoParametersInstance)
                End If

                HttpContext.Current.Session(String.Format(CultureInfo.InvariantCulture, "Form.{0}.trace", IO.Path.GetFileNameWithoutExtension("Page.AppRelativeVirtualPath"))) = String.Empty

                If id.IsEmpty AndAlso urlid.IsEmpty Then
                    Form_Initialization(currentAction, HT5CambioCorreoClientesDemoParametersInstance, resultData)
                End If


                instance = ClassToEntryData(instance, HT5CambioCorreoClientesDemoParametersInstance) 
		        StoreFormInformationOnSession(HT5CambioCorreoClientesDemoParametersInstance)
                
                                
                With resultData
                    .Success = True
                    .Data = New With {.Instance = instance, .LookUps = Nothing}
                End With

            Catch ex As Exception
                resultData = InMotionGIT.FrontOffice.Support.ExceptionHandler.ProcessServerAction(ex, "HT5CambioCorreoClientesDemo", "Initialization", currentAction)
            End Try
            
            Return resultData
        End Function
  

        <WebMethod(EnableSession:=True)>
        Public Shared Function button4Click(instance As EntryData) As InMotionGIT.FrontOffice.Support.DataType.ServerActionResult
            
            Dim resultData As New InMotionGIT.FrontOffice.Support.DataType.ServerActionResult
            Dim HT5CambioCorreoClientesDemoParametersInstance As HT5CambioCorreoClientesDemoParameters = Nothing
            Dim UserInfo As InMotionGIT.Membership.Providers.MemberContext = Nothing
            Dim formContext As InMotionGIT.Common.Contracts.Context = Nothing
            Dim selectDataTableItem As DataTable = Nothing
            Dim currentAction As String = String.Empty
            Dim messageAction As String = String.Empty
            Dim parametersDictionary As Dictionary(Of String, Object) = Nothing
            Dim WorkflowInArguments As Dictionary(Of String, Object) = Nothing
            Dim WorkflowOutArguments As IDictionary(Of String, Object) = Nothing
            Dim isNullResult As Boolean = True
            Dim isFoundData As Boolean = False
            
            Try
                InMotionGIT.FASI.Support.Authentication.AuthorizationProcess("EASE1")
                HT5CambioCorreoClientesDemoParametersInstance = RetrieveFormInformationFromSession(instance.InstanceFormId)
                UserInfo = New InMotionGIT.Membership.Providers.MemberContext
                formContext = New InMotionGIT.Common.Contracts.Context(InMotionGIT.FASI.Support.Handlers.LanguageHandler.LanguageId(), 
                                                                       instance.InstanceFormId) With {.UserId = HttpContext.Current.Session("UserId"), 
                                                                                                      .UserCode = HttpContext.Current.Session("nUsercode"), 
                                                                                                      .SecuritySchemeCode = HttpContext.Current.Session("sSche_code"), 
                                                                                                      .AccessToken = HttpContext.Current.Session("AccessToken")}
                currentAction = SessionTrace("button4Click")
                HT5CambioCorreoClientesDemoParametersInstance = EntryDataToClass(HT5CambioCorreoClientesDemoParametersInstance, instance)
                currentAction = SessionTrace("1. HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.CompanyId = 1...")
                currentAction = SessionTrace("1.1. HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.CompanyId = 1...")
                                If IsNothing(HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation) Then
                    HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation = New InMotionGIT.Common.Contracts.Process.ConsumerInformation
                End If

                HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.CompanyId = 1
                currentAction = SessionTrace("1.2. HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Country = 58...")
                                If IsNothing(HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation) Then
                    HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation = New InMotionGIT.Common.Contracts.Process.ConsumerInformation
                End If

                HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Country = 58
                currentAction = SessionTrace("1.3. HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Security.Usercode = 9998...")
                                If IsNothing(HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation) Then
                    HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation = New InMotionGIT.Common.Contracts.Process.ConsumerInformation
                End If
                                If IsNothing(HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Security) Then
                    HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Security = New InMotionGIT.Common.Contracts.Process.SecurityInformation
                End If

                HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Security.Usercode = 9998

                currentAction = SessionTrace("3. For Each emailAddress As 'InMotionGIT.General.Entit...' In 'HT5CambioCorreoClientesDemoParametersInstance.AddressCollecti...'")
                For Each emailAddress As InMotionGIT.General.Entity.Contracts.Address.Address In HT5CambioCorreoClientesDemoParametersInstance.AddressCollection

                    currentAction = SessionTrace("4. HT5CambioCorreoClientesDemoParametersInstance.emailToUpdate = emailAddress.Email...")
                    currentAction = SessionTrace("4.1. HT5CambioCorreoClientesDemoParametersInstance.emailToUpdate = emailAddress.Email...")

                    HT5CambioCorreoClientesDemoParametersInstance.emailToUpdate = emailAddress.Email
                    currentAction = SessionTrace("4.2. HT5CambioCorreoClientesDemoParametersInstance.KeyAddressForUpdate = emailAddress.KeyToAddressRecord...")

                    HT5CambioCorreoClientesDemoParametersInstance.KeyAddressForUpdate = emailAddress.KeyToAddressRecord
                    currentAction = SessionTrace("4.3. HT5CambioCorreoClientesDemoParametersInstance.ClientIdForUpdate = emailAddress.ClientID...")

                    HT5CambioCorreoClientesDemoParametersInstance.ClientIdForUpdate = emailAddress.ClientID

                currentAction = SessionTrace("5. UPDATE 'ADDRESS' SET SE_MAIL = HT5CambioCorreoClientesDemoParametersInstance.emailToUpdate... WHERE ADDRESS.SKEYADDRESS = HT5CambioCorreoClientesDemoParametersInstance.KeyAddressForUpdate AND ADDRESS.SCLIENT = HT5CambioCorreoClientesDemoParametersInstance.ClientIdForUpdate ...")
                            With New DataManagerFactory("UPDATE INSUDB.ADDRESS SET SE_MAIL = @:SE_MAIL WHERE ADDRESS.SKEYADDRESS = @:ADDRESSSKEYADDRESS0 AND ADDRESS.SCLIENT = @:ADDRESSSCLIENT1", "ADDRESS", "Linked.LatCombined")
.AddParameter("SE_MAIL", DbType.AnsiStringFixedLength, 60, (HT5CambioCorreoClientesDemoParametersInstance.emailToUpdate = String.Empty), HT5CambioCorreoClientesDemoParametersInstance.emailToUpdate)
.AddParameter("ADDRESSSKEYADDRESS0", DbType.AnsiStringFixedLength, 50, (HT5CambioCorreoClientesDemoParametersInstance.KeyAddressForUpdate = String.Empty), HT5CambioCorreoClientesDemoParametersInstance.KeyAddressForUpdate)
.AddParameter("ADDRESSSCLIENT1", DbType.AnsiStringFixedLength, 14, (HT5CambioCorreoClientesDemoParametersInstance.ClientIdForUpdate = String.Empty), HT5CambioCorreoClientesDemoParametersInstance.ClientIdForUpdate)
 
                    .CommandExecute()
              End With
                    Next
                currentAction = SessionTrace("6. The message 'Correos actualizados...' will displayed as 'Splash'")
                ParametersToDictionary(HT5CambioCorreoClientesDemoParametersInstance, parametersDictionary)
                messageAction = "Correos actualizados"
                messageAction = InMotionGIT.FrontOffice.Proxy.Helpers.Email.Process(messageAction, parametersDictionary)
                resultData.AddNotifySplash(messageAction)

                instance = ClassToEntryData(instance, HT5CambioCorreoClientesDemoParametersInstance)
                StoreFormInformationOnSession(HT5CambioCorreoClientesDemoParametersInstance)
                
                With resultData
                    .Success = True
                    .Data = instance
                End With

            Catch ex As Exception
                resultData = InMotionGIT.FrontOffice.Support.ExceptionHandler.ProcessServerAction(ex, "HT5CambioCorreoClientesDemo", "button4Click", currentAction)
            End Try
            
            Return resultData
        End Function
        <WebMethod(EnableSession:=True)>
        Public Shared Function button1Click(instance As EntryData) As InMotionGIT.FrontOffice.Support.DataType.ServerActionResult
            
            Dim resultData As New InMotionGIT.FrontOffice.Support.DataType.ServerActionResult
            Dim HT5CambioCorreoClientesDemoParametersInstance As HT5CambioCorreoClientesDemoParameters = Nothing
            Dim UserInfo As InMotionGIT.Membership.Providers.MemberContext = Nothing
            Dim formContext As InMotionGIT.Common.Contracts.Context = Nothing
            Dim selectDataTableItem As DataTable = Nothing
            Dim currentAction As String = String.Empty
            Dim messageAction As String = String.Empty
            Dim parametersDictionary As Dictionary(Of String, Object) = Nothing
            Dim WorkflowInArguments As Dictionary(Of String, Object) = Nothing
            Dim WorkflowOutArguments As IDictionary(Of String, Object) = Nothing
            Dim isNullResult As Boolean = True
            Dim isFoundData As Boolean = False
            
            Try
                InMotionGIT.FASI.Support.Authentication.AuthorizationProcess("EASE1")
                HT5CambioCorreoClientesDemoParametersInstance = RetrieveFormInformationFromSession(instance.InstanceFormId)
                UserInfo = New InMotionGIT.Membership.Providers.MemberContext
                formContext = New InMotionGIT.Common.Contracts.Context(InMotionGIT.FASI.Support.Handlers.LanguageHandler.LanguageId(), 
                                                                       instance.InstanceFormId) With {.UserId = HttpContext.Current.Session("UserId"), 
                                                                                                      .UserCode = HttpContext.Current.Session("nUsercode"), 
                                                                                                      .SecuritySchemeCode = HttpContext.Current.Session("sSche_code"), 
                                                                                                      .AccessToken = HttpContext.Current.Session("AccessToken")}
                currentAction = SessionTrace("button1Click")
                HT5CambioCorreoClientesDemoParametersInstance = EntryDataToClass(HT5CambioCorreoClientesDemoParametersInstance, instance)
                currentAction = SessionTrace("1. DELETE FROM 'eMails' WHERE eMails.AddressID = HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar ...")
                        With New DataManagerFactory("DELETE FROM ADDRESS.eMails WHERE (EMAILS.ADDRESSID = @:EMAILSADDRESSID0)", "eMails", "Linked.Address")
.AddParameter("EMAILSADDRESSID0", DbType.Decimal, 10, False, HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar)
 
                    .CommandExecute()
              End With
                currentAction = SessionTrace("2. DELETE FROM 'PartsOfAddress' WHERE PartsOfAddress.AddressID = HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar ...")
                        With New DataManagerFactory("DELETE FROM ADDRESS.PartsOfAddress WHERE (PARTSOFADDRESS.ADDRESSID = @:PARTSOFADDRESSADDRESSID0)", "PartsOfAddress", "Linked.Address")
.AddParameter("PARTSOFADDRESSADDRESSID0", DbType.Decimal, 10, False, HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar)
 
                    .CommandExecute()
              End With
                currentAction = SessionTrace("3. DELETE FROM 'RiskZones' WHERE RiskZones.AddressID = HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar ...")
                        With New DataManagerFactory("DELETE FROM ADDRESS.RiskZones WHERE (RISKZONES.ADDRESSID = @:RISKZONESADDRESSID0)", "RiskZones", "Linked.Address")
.AddParameter("RISKZONESADDRESSID0", DbType.Decimal, 10, False, HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar)
 
                    .CommandExecute()
              End With
                currentAction = SessionTrace("4. DELETE FROM 'OtherTypeAddress' WHERE OtherTypeAddress.AddressID = HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar ...")
                        With New DataManagerFactory("DELETE FROM ADDRESS.OtherTypeAddress WHERE (OTHERTYPEADDRESS.ADDRESSID = @:OTHERTYPEADDRESSADDRESSID0)", "OtherTypeAddress", "Linked.Address")
.AddParameter("OTHERTYPEADDRESSADDRESSID0", DbType.Decimal, 10, False, HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar)
 
                    .CommandExecute()
              End With
                currentAction = SessionTrace("5. DELETE FROM 'SocialNetwork' WHERE SocialNetwork.AddressID = HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar ...")
                        With New DataManagerFactory("DELETE FROM ADDRESS.SocialNetwork WHERE (SOCIALNETWORK.ADDRESSID = @:SOCIALNETWORKADDRESSID0)", "SocialNetwork", "Linked.Address")
.AddParameter("SOCIALNETWORKADDRESSID0", DbType.Decimal, 10, False, HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar)
 
                    .CommandExecute()
              End With
                currentAction = SessionTrace("6. DELETE FROM 'PhysicalAddresses' WHERE PhysicalAddresses.AddressID = HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar ...")
                        With New DataManagerFactory("DELETE FROM ADDRESS.PhysicalAddresses WHERE (PHYSICALADDRESSES.ADDRESSID = @:PHYSICALADDRESSESADDRESSID0)", "PhysicalAddresses", "Linked.Address")
.AddParameter("PHYSICALADDRESSESADDRESSID0", DbType.Decimal, 10, False, HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar)
 
                    .CommandExecute()
              End With
                currentAction = SessionTrace("7. DELETE FROM 'Address' WHERE Address.AddressID = HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar ...")
                        With New DataManagerFactory("DELETE FROM ADDRESS.Address WHERE (ADDRESS.ADDRESSID = @:ADDRESSADDRESSID0)", "Address", "Linked.Address")
.AddParameter("ADDRESSADDRESSID0", DbType.Decimal, 10, False, HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar)
 
                    .CommandExecute()
              End With
                currentAction = SessionTrace("8. DELETE FROM 'AddressMaster' WHERE AddressMaster.AddressID = HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar ...")
                        With New DataManagerFactory("DELETE FROM ADDRESS.AddressMaster WHERE (ADDRESSMASTER.ADDRESSID = @:ADDRESSMASTERADDRESSID0)", "AddressMaster", "Linked.Address")
.AddParameter("ADDRESSMASTERADDRESSID0", DbType.Decimal, 10, False, HT5CambioCorreoClientesDemoParametersInstance.DireccionABorrar)
 
                    .CommandExecute()
              End With

                instance = ClassToEntryData(instance, HT5CambioCorreoClientesDemoParametersInstance)
                StoreFormInformationOnSession(HT5CambioCorreoClientesDemoParametersInstance)
                
                With resultData
                    .Success = True
                    .Data = instance
                End With

            Catch ex As Exception
                resultData = InMotionGIT.FrontOffice.Support.ExceptionHandler.ProcessServerAction(ex, "HT5CambioCorreoClientesDemo", "button1Click", currentAction)
            End Try
            
            Return resultData
        End Function

#End Region

#Region "Lookups Web Methods"


#End Region

#Region "Form Actions"

        Private Shared Sub Form_Initialization(ByRef currentAction As String, ByRef HT5CambioCorreoClientesDemoParametersInstance As HT5CambioCorreoClientesDemoParameters, ByRef resultData As InMotionGIT.FrontOffice.Support.DataType.ServerActionResult)
            Dim UserInfo As New InMotionGIT.Membership.Providers.MemberContext
            
            Dim formContext As New InMotionGIT.Common.Contracts.Context(InMotionGIT.FASI.Support.Handlers.LanguageHandler.LanguageId(), 
                                                                        HT5CambioCorreoClientesDemoParametersInstance.InternalId) With {.UserId = HttpContext.Current.Session("UserId"), 
                                                                                                                     .UserCode = HttpContext.Current.Session("nUsercode"), 
                                                                                                                     .SecuritySchemeCode = HttpContext.Current.Session("sSche_code"), 
                                                                                                                     .AccessToken = HttpContext.Current.Session("AccessToken")}
            Dim selectDataTableItem As DataTable = Nothing
            Dim parametersDictionary As Dictionary(Of String, Object) = Nothing
            Dim WorkflowInArguments As Dictionary(Of String, Object) = Nothing
            Dim WorkflowOutArguments As IDictionary(Of String, Object) = Nothing
            Dim messageAction As String = String.Empty
            Dim isNullResult As Boolean = True
            Dim isFoundData As Boolean = False

            currentAction = SessionTrace("Form_Initialization")

            currentAction = SessionTrace("1. HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.CompanyId = 1...")
            currentAction = SessionTrace("1.1. HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.CompanyId = 1...")
                            If IsNothing(HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation) Then
                    HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation = New InMotionGIT.Common.Contracts.Process.ConsumerInformation
                End If

            HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.CompanyId = 1
            currentAction = SessionTrace("1.2. HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Country = 58...")
                            If IsNothing(HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation) Then
                    HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation = New InMotionGIT.Common.Contracts.Process.ConsumerInformation
                End If

            HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Country = 58
            currentAction = SessionTrace("1.3. HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Security.Usercode = 9998...")
                            If IsNothing(HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation) Then
                    HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation = New InMotionGIT.Common.Contracts.Process.ConsumerInformation
                End If
                            If IsNothing(HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Security) Then
                    HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Security = New InMotionGIT.Common.Contracts.Process.SecurityInformation
                End If

            HT5CambioCorreoClientesDemoParametersInstance.ConsumerInformation.Security.Usercode = 9998

            currentAction = SessionTrace("2. 'HT5CambioCorreoClientesDemoParametersInstance.AddressDLICollection' = New 'InMotionGIT.AddressManage'...'")
            HT5CambioCorreoClientesDemoParametersInstance.AddressDLICollection = New InMotionGIT.AddressManager.Contract.General.AddressDLICollection

            currentAction = SessionTrace("5. SELECT CLIENT.SCLIENT, CLIENT.SCLIENAME FROM CLIENT... WHERE CLIENT.SCLIENT = 00001006180010 OR CLIENT.SCLIENT = 00002006180010 OR CLIENT.SCLIENT = 00003006180010 OR )")
            isFoundData = False
                   With New DataManagerFactory("SELECT TRIM(CLIENT.SCLIENT) SCLIENT, TRIM(CLIENT.SCLIENAME) SCLIENAME, ADDRESS.NRECOWNER, TRIM(ADDRESS.SKEYADDRESS) SKEYADDRESS, ADDRESS.DEFFECDATE, TRIM(ADDRESS.SE_MAIL) SE_MAIL, ADDRESS.DNULLDATE FROM CLIENT CLIENT  JOIN ADDRESS ADDRESS ON ADDRESS.SCLIENT = CLIENT.SCLIENT  WHERE (CLIENT.SCLIENT = '00001006180010' OR CLIENT.SCLIENT = '00002006180010' OR CLIENT.SCLIENT = '00003006180010' OR CLIENT.SCLIENT = '00000000009998' OR CLIENT.SCLIENT = '00000000009993') AND ADDRESS.DNULLDATE IS NULL", "CLIENT", "Linked.LatCombined")
 
            selectDataTableItem = .QueryExecuteToTable(True)  
        End With
            With selectDataTableItem
                    If Not IsNothing(.Rows) AndAlso .Rows.Count > 0 Then
                        isFoundData = True 
                        HT5CambioCorreoClientesDemoParametersInstance.AddressCollection = New InMotionGIT.General.Entity.Contracts.Address.AddressCollection 
                        Dim newItem As InMotionGIT.General.Entity.Contracts.Address.Address 
                        For Each itemData As DataRow In .Rows
                             newItem = New InMotionGIT.General.Entity.Contracts.Address.Address
                        newItem.ClientID = itemData.StringValue("SCLIENT") 
                        newItem.CustomString = itemData.StringValue("SCLIENAME") 
                        newItem.KeyToAddressRecord = itemData.StringValue("SKEYADDRESS") 
                        newItem.RecordEffectiveDate = itemData.DateTimeValue("DEFFECDATE") 
                        newItem.Email = itemData.StringValue("SE_MAIL") 

                              HT5CambioCorreoClientesDemoParametersInstance.AddressCollection.Add(newItem)
                        Next
                    End If
            End With


            
        End Sub

#End Region
#Region "Utilities"

        Private Shared Sub ParametersToDictionary(formData As HT5CambioCorreoClientesDemoParameters, ByRef target As Dictionary(Of String, Object))
            If IsNothing(target) Then
                target = New Dictionary(Of String, Object)

                target.Add("AddressDLICollection", formData.AddressDLICollection)
                target.Add("DireccionABorrar", formData.DireccionABorrar)
                target.Add("ConsumerInformation", formData.ConsumerInformation)
                target.Add("ClientCollection", formData.ClientCollection)
                target.Add("AddressCollection", formData.AddressCollection)
                target.Add("emailToUpdate", formData.emailToUpdate)
                target.Add("KeyAddressForUpdate", formData.KeyAddressForUpdate)
                target.Add("ClientIdForUpdate", formData.ClientIdForUpdate)
            Else
                target("AddressDLICollection") = formData.AddressDLICollection
                target("DireccionABorrar") = formData.DireccionABorrar
                target("ConsumerInformation") = formData.ConsumerInformation
                target("ClientCollection") = formData.ClientCollection
                target("AddressCollection") = formData.AddressCollection
                target("emailToUpdate") = formData.emailToUpdate
                target("KeyAddressForUpdate") = formData.KeyAddressForUpdate
                target("ClientIdForUpdate") = formData.ClientIdForUpdate
            End If
        End Sub

        Private Shared Sub GetTransferParameters(parametersData As HT5CambioCorreoClientesDemoParameters, fromid As String)
            Dim fromDocumentCache As Object = Nothing

            If Not String.IsNullOrEmpty(fromid) Then
                fromDocumentCache = HttpContext.Current.Session(fromid)
                HttpContext.Current.Session.Remove(fromid)

            Else
                fromDocumentCache = HttpContext.Current.Session(HttpContext.Current.Session("fromid"))
                HttpContext.Current.Session.Remove(HttpContext.Current.Session("fromid"))
                HttpContext.Current.Session.Remove("fromid")
            End If

            If Not IsNothing(fromDocumentCache) Then
                InMotionGIT.FrontOffice.Support.Helpers.ReflectionHandler.AssignPropertyValue("AddressDLICollection", fromDocumentCache, parametersData)
                InMotionGIT.FrontOffice.Support.Helpers.ReflectionHandler.AssignPropertyValue("DireccionABorrar", fromDocumentCache, parametersData)
                InMotionGIT.FrontOffice.Support.Helpers.ReflectionHandler.AssignPropertyValue("ConsumerInformation", fromDocumentCache, parametersData)
                InMotionGIT.FrontOffice.Support.Helpers.ReflectionHandler.AssignPropertyValue("ClientCollection", fromDocumentCache, parametersData)
                InMotionGIT.FrontOffice.Support.Helpers.ReflectionHandler.AssignPropertyValue("AddressCollection", fromDocumentCache, parametersData)
                InMotionGIT.FrontOffice.Support.Helpers.ReflectionHandler.AssignPropertyValue("emailToUpdate", fromDocumentCache, parametersData)
                InMotionGIT.FrontOffice.Support.Helpers.ReflectionHandler.AssignPropertyValue("KeyAddressForUpdate", fromDocumentCache, parametersData)
                InMotionGIT.FrontOffice.Support.Helpers.ReflectionHandler.AssignPropertyValue("ClientIdForUpdate", fromDocumentCache, parametersData)
            End If
        End Sub

        Private Shared Function SessionTrace(message As String) As String

            If Not IsNothing(HttpContext.Current.Session("Form.Track")) AndAlso HttpContext.Current.Session("Form.Track").ToString.ToLower = "true" Then
                Dim tracelog As String = HttpContext.Current.Session(String.Format(CultureInfo.InvariantCulture, "Form.{0}.trace", IO.Path.GetFileNameWithoutExtension("Page.AppRelativeVirtualPath")))

                tracelog += String.Format(CultureInfo.InvariantCulture, "{0} {1}<br>{2}", Now.ToString("hh:mm:ss.fff"), message, vbCrLf)
                HttpContext.Current.Session(String.Format(CultureInfo.InvariantCulture, "Form.{0}.trace", IO.Path.GetFileNameWithoutExtension("Page.AppRelativeVirtualPath"))) = tracelog
            End If

            Return message
        End Function

#End Region
#Region "Storage Session Methods"

        Private Shared Function RetrieveFormInformationFromSession(id As String) As HT5CambioCorreoClientesDemoParameters
            
            Dim source As String = HttpContext.Current.Session(String.Format(CultureInfo.InvariantCulture, "Form.Storage.{0}", id))
            Dim instance As HT5CambioCorreoClientesDemoParameters = Nothing

            If Not String.IsNullOrEmpty(source) Then
                instance = Serialize.Deserialize(Of HT5CambioCorreoClientesDemoParameters)(source)
            End If
            
            Return instance
        End Function

        Private Shared Sub StoreFormInformationOnSession(instance As HT5CambioCorreoClientesDemoParameters)
            
            If Not IsNothing(instance) Then
                HttpContext.Current.Session(String.Format(CultureInfo.InvariantCulture, "Form.Storage.{0}", instance.InternalId)) = Serialize.Serialize(Of HT5CambioCorreoClientesDemoParameters)(instance)
                HttpContext.Current.Session(String.Format(CultureInfo.InvariantCulture, "Form.Title.{0}", instance.InternalId)) = "HT5Cambio de correo de clientes - demo"
              
                If Not IsNothing(HttpContext.Current.Session("Form.Track")) AndAlso
                   HttpContext.Current.Session("Form.Track").ToString.ToLower = "true" Then

                    HttpContext.Current.Session(String.Format(CultureInfo.InvariantCulture, "Form.HT5CambioCorreoClientesDemo", instance.InternalId)) = instance
                End If

                If Not IsNothing(HttpContext.Current.Session("Form.Track.Parameters")) AndAlso
                   HttpContext.Current.Session("Form.Track.Parameters").ToString.ToLower = "true" Then

                    If Not IsNothing(HttpContext.Current.Session("Form.Track")) AndAlso HttpContext.Current.Session("Form.Track").ToString.ToLower = "true" Then
                        InMotionGIT.Common.Helpers.FileHandler.SaveContent(String.Format(CultureInfo.InvariantCulture, "{0}\{1}.HT5CambioCorreoClientesDemo.txt",
                                                                                         ConfigurationManager.AppSettings("Path.Logs"), instance.InternalId),
                                                                                          HttpContext.Current.Session(String.Format(CultureInfo.InvariantCulture,
                                                                                                                     "Form.{0}.trace", IO.Path.GetFileNameWithoutExtension("Page.AppRelativeVirtualPath"))))
                    End If

                    InMotionGIT.Common.Helpers.Serialize.SerializeToFile(Of HT5CambioCorreoClientesDemoParameters)(instance,
                                                                                                String.Format(CultureInfo.InvariantCulture,
                                                                                                              "{0}\{1}.HT5CambioCorreoClientesDemo.xml", ConfigurationManager.AppSettings("Path.Logs"), instance.InternalId), True)
                End If			
            End If
            
        End Sub

#End Region


#Region "Contracts Mappers"

        Private Shared Function EntryDataToClass(parametersData As HT5CambioCorreoClientesDemoParameters, formData As EntryData) As HT5CambioCorreoClientesDemoParameters
            If IsNothing(parametersData) Then
                parametersData = New HT5CambioCorreoClientesDemoParameters
            End If

            If IsNothing(parametersData.AddressCollection) Then
                parametersData.AddressCollection = New InMotionGIT.General.Entity.Contracts.Address.AddressCollection
            End If
            If IsNothing(parametersData.ClientCollection) Then
                parametersData.ClientCollection = New InMotionGIT.Client.Entity.Contracts.ClientCollection
            End If

            With parametersData
                .InternalId = formData.InstanceFormId
                 If formData.AddressDLI_Address.IsNotEmpty Then
                    Dim temporalAddressCollection As New InMotionGIT.General.Entity.Contracts.Address.AddressCollection
                    Dim currentItem As InMotionGIT.General.Entity.Contracts.Address.Address

	            For Each itemData As AddressDLI_AddressItem In formData.AddressDLI_Address
                        currentItem = (From _x In parametersData.AddressCollection Where _x.KeyToAddressRecord = itemData.KeyToAddressRecord Select _x).FirstOrDefault()
                     
	                If currentItem.IsEmpty Then
                            currentItem = New InMotionGIT.General.Entity.Contracts.Address.Address
                  
                            With currentItem

                                .RecordEffectiveDate = itemData.RecordEffectiveDate
                                .Email = itemData.Email
                                .ClientID = itemData.ClientID
                                .CustomString = itemData.CustomString
                                .KeyToAddressRecord = itemData.KeyToAddressRecord
                            End With                      
                                              
	                Else
                            With currentItem

                                .RecordEffectiveDate = itemData.RecordEffectiveDate
                                .Email = itemData.Email
                                .ClientID = itemData.ClientID
                                .CustomString = itemData.CustomString
                                .KeyToAddressRecord = itemData.KeyToAddressRecord
                            End With
                        End If
                        
                        temporalAddressCollection.Add(currentItem)
                    Next
                    
                    parametersData.AddressCollection = temporalAddressCollection
                 End If

                .DireccionABorrar = formData.DireccionABorrar
            End With

            Return parametersData
        End Function

        Private Shared Function ClassToEntryData(formData As EntryData, parametersData As HT5CambioCorreoClientesDemoParameters) As EntryData
            formData = New EntryData

            With formData
                .InstanceFormId = parametersData.InternalId
                .AddressDLI_Address = New List(Of AddressDLI_AddressItem)

                If Not IsNothing(parametersData.AddressCollection) Then
                    Dim newItem As AddressDLI_AddressItem
                    
                    For Each itemData As InMotionGIT.General.Entity.Contracts.Address.Address In parametersData.AddressCollection
                        newItem = New AddressDLI_AddressItem
                        
                        With newItem
                            .RecordEffectiveDate = itemData.RecordEffectiveDate
                            .Email = itemData.Email
                            .ClientID = itemData.ClientID
                            .CustomString = itemData.CustomString
                            .KeyToAddressRecord = itemData.KeyToAddressRecord                        
                        End With

                        .AddressDLI_Address.Add(newItem)
                    Next

                    If .AddressDLI_Address.Count <> 0 Then

                    End If
                End If


                .Client_Client = New List(Of Client_ClientItem)

                If Not IsNothing(parametersData.ClientCollection) Then
                    Dim newItem As Client_ClientItem
                    
                    For Each itemData As InMotionGIT.Client.Entity.Contracts.Client In parametersData.ClientCollection
                        newItem = New Client_ClientItem
                        
                        With newItem
                            .ClientID = itemData.ClientID
                            .CompleteClientName = itemData.CompleteClientName
                            .NADDRESSID = itemData.NADDRESSID                        
                        End With

                        .Client_Client.Add(newItem)
                    Next

                    If .Client_Client.Count <> 0 Then

                    End If
                End If


                .DireccionABorrar = parametersData.DireccionABorrar
            End With

            Return formData
        End Function

#End Region

#Region "Common Utilities"

        Private Shared Sub SetDefaultValuesFromQueryString(formData As HT5CambioCorreoClientesDemoParameters)
            If HttpContext.Current.Request.QueryString("DireccionABorrar").IsNotEmpty Then
                formData.DireccionABorrar = HttpContext.Current.Request.QueryString("DireccionABorrar")
            End If
            If HttpContext.Current.Request.QueryString("emailToUpdate").IsNotEmpty Then
                formData.emailToUpdate = HttpContext.Current.Request.QueryString("emailToUpdate")
            End If
            If HttpContext.Current.Request.QueryString("KeyAddressForUpdate").IsNotEmpty Then
                formData.KeyAddressForUpdate = HttpContext.Current.Request.QueryString("KeyAddressForUpdate")
            End If
            If HttpContext.Current.Request.QueryString("ClientIdForUpdate").IsNotEmpty Then
                formData.ClientIdForUpdate = HttpContext.Current.Request.QueryString("ClientIdForUpdate")
            End If
        End Sub	

        Private Shared Sub ValidateParametersInstance(ByRef formData As HT5CambioCorreoClientesDemoParameters)
            If IsNothing(formData.AddressCollection) Then
                formData.AddressCollection = New InMotionGIT.General.Entity.Contracts.Address.AddressCollection
            End If
            If IsNothing(formData.ClientCollection) Then
                formData.ClientCollection = New InMotionGIT.Client.Entity.Contracts.ClientCollection
            End If

        End Sub

#End Region

#Region "Form Contracts"

        <Serializable()>
        <DataContract()>
        Public Class EntryData

            <DataMember()> Public Property InstanceFormId As String
            <DataMember()> Public Property AddressCollectionRecordEffectiveDate As System.DateTime
            <DataMember()> Public Property AddressCollectionEmail As System.String
            <DataMember()> Public Property AddressCollectionClientID As System.String
            <DataMember()> Public Property AddressCollectionCustomString As System.String
            <DataMember()> Public Property AddressCollectionKeyToAddressRecord As System.String
            <DataMember()> Public Property AddressDLI_Address As List(Of AddressDLI_AddressItem)
            <DataMember()> Public Property ClientCollectionClientID As System.String
            <DataMember()> Public Property ClientCollectionCompleteClientName As System.String
            <DataMember()> Public Property ClientCollectionNADDRESSID As System.Int64
            <DataMember()> Public Property Client_Client As List(Of Client_ClientItem)
            <DataMember()> Public Property DireccionABorrar As Int32

        End Class

        <Serializable()>
        <DataContract()>
        Public Class AddressDLI_AddressItem

            <DataMember()> Public Property RecordEffectiveDate As System.DateTime
            <DataMember()> Public Property Email As System.String
            <DataMember()> Public Property ClientID As System.String
            <DataMember()> Public Property CustomString As System.String
            <DataMember()> Public Property KeyToAddressRecord As System.String

        End Class

        <Serializable()>
        <DataContract()>
        Public Class Client_ClientItem

            <DataMember()> Public Property ClientID As System.String
            <DataMember()> Public Property CompleteClientName As System.String
            <DataMember()> Public Property NADDRESSID As System.Int64

        End Class

        <Serializable()>
        Public Class HT5CambioCorreoClientesDemoParameters
            Inherits InMotionGIT.FrontOffice.Support.DataType.FormBase(Of HT5CambioCorreoClientesDemoParameters)

            Public Property AddressDLICollection As InMotionGIT.AddressManager.Contract.General.AddressDLICollection
            Public Property DireccionABorrar As Int32
            Public Property ConsumerInformation As InMotionGIT.Common.Contracts.Process.ConsumerInformation
            Public Property ClientCollection As InMotionGIT.Client.Entity.Contracts.ClientCollection
            Public Property AddressCollection As InMotionGIT.General.Entity.Contracts.Address.AddressCollection
            Public Property emailToUpdate As String
            Public Property KeyAddressForUpdate As String
            Public Property ClientIdForUpdate As String

        End Class
#End Region

    End Class

End Namespace

