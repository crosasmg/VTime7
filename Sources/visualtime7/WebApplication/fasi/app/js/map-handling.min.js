var map,defaultBounds,infowindow,map_options={};function toggleBounce(e){null!==e.getAnimation()?e.setAnimation(null):e.setAnimation(google.maps.Animation.BOUNCE)}function getElevation(e){var o=[];o.push(e);var t={locations:o};(new google.maps.ElevationService).getElevationForLocations(t,function(e,o){o==google.maps.ElevationStatus.OK?e[0]?$("#txtElevationEdit").val(e[0].elevation):(console.log("No se han encontrado resultados."),$("#txtElevationEdit").val("0")):(console.log("El servicio de elevación ha fallado. Error: "+o),$("#txtElevationEdit").val("0"))})}function setMarkerAndInfoWindow(e,o,t,n,a){var i=e.latLng;getElevation(i),t.setCenter(i),n.setPosition(i),(new google.maps.Geocoder).geocode({latLng:i},function(e,r){if(r==google.maps.GeocoderStatus.OK){var l="",s=e[0].formatted_address;if(e[0]){for(var d=0;d<e[0].address_components.length;d++)"administrative_area_level_1"==e[0].address_components[d].types[0]&&(l+=e[0].address_components[d].short_name);setValuesFromMap(o,e[0].address_components,i),""!==s?a.setContent("<div><strong>"+s+"</strong><br></div>"):a.setContent("<div><strong>"+l+"</strong><br></div>"),a.open(t,n)}else alert("No results found")}else alert("Geocoder failed due to: "+r)})}function defaultMapBehaviorOnForm(e){infowindow=new google.maps.InfoWindow,map_options={zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!0,disableDefaultUI:!1},map=new google.maps.Map(document.getElementById(e+"Map"),map_options),marker=new google.maps.Marker({map:map,draggable:!1,animation:google.maps.Animation.DROP,position:map.getCenter()});var o=document.getElementById(e+"StreetOrUrl"),t=new google.maps.places.Autocomplete(o);t.bindTo("bounds",map),window.setTimeout(function(){mapAutocompleteEvent(e,t,map,infowindow,marker)},500)}function defaultMapBehavior(e,o,t,n){var a=document.getElementById(o+"Autocomplete"),i=new google.maps.places.Autocomplete(a);i.bindTo("bounds",e),window.setTimeout(function(){mapAutocompleteEvent(o,i,e,t,n),mapClickEvent(o,e,n,t),mapDragAndDropEvent(o,e,n,t)},500)}function loadMap(e,o,t){infowindow=new google.maps.InfoWindow,map_options={center:new google.maps.LatLng(e,o),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!0,disableDefaultUI:!1},map=new google.maps.Map(document.getElementById(t+"Map"),map_options),marker=new google.maps.Marker({map:map,draggable:!0,animation:google.maps.Animation.DROP,position:map.getCenter()}),defaultMapBehavior(map,t,infowindow,marker)}function loadMapUsingLocation(e){infowindow=new google.maps.InfoWindow,map_options={zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!0,disableDefaultUI:!1},map=new google.maps.Map(document.getElementById(e+"Map"),map_options),marker=new google.maps.Marker({map:map,draggable:!0,animation:google.maps.Animation.DROP,position:map.getCenter()}),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){var t=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);map.setCenter(t),defaultMapBehavior(map,e,infowindow,marker),marker.setPosition(t),infowindow.setContent("<div><strong>Ubicación actual aproximada.</strong></div>"),infowindow.open(map,marker),setLatitudeAndLongitude(e,t),getElevation(t)},function(){handleNoGeolocation(!0,infowindow)}):handleNoGeolocation(!1,infowindow)}function handleNoGeolocation(e,o){var t="";t=e?"Error: El servicio de Geolocation ha fallado.":"Error: Su navegador no soporta geolocation.";var n={map:map,zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,disableDefaultUI:!1,position:new google.maps.LatLng(-33.4136972,-70.5838192),content:t};new google.maps.InfoWindow(n),map.setCenter(n.position)}function mapAutocompleteEvent(e,o,t,n,a){google.maps.event.addListener(o,"place_changed",function(i){try{var r=o.getPlace();if(!r.geometry)return void console.log("Autocomplete's returned place contains no geometry");r.geometry.viewport?t.fitBounds(r.geometry.viewport):(t.setCenter(r.geometry.location),t.setZoom(16)),getElevation(r.geometry.location),a.setPosition(r.geometry.location),setValuesFromMap(e,r.address_components,t.center),n.setContent("<div><strong>"+r.formatted_address+"</strong></div>"),n.open(t,a),toastr.info("Address updated.")}catch(e){toastr.error("Invalid Address."),console.log("Invalid Address.")}})}function mapClickEvent(e,o,t,n){google.maps.event.addListener(o,"click",function(a){setMarkerAndInfoWindow(a,e,o,t,n),toggleBounce(t),setTimeout(toggleBounce(t),100)})}function mapDragAndDropEvent(e,o,t,n){google.maps.event.addListener(t,"dragend",function(a){setMarkerAndInfoWindow(a,e,o,t,n)})}function setValuesFromMap(e,o,t){setLatitudeAndLongitude(e,t),setStreetOrUrl(e,o),setPostalCode(e,o),setCountry(e,o),setMunicipality(e,o),setProvince(e,o),setLocality(e,o)}function setStreetOrUrl(e,o){try{var t=o[1].short_name+" "+o[0].short_name;t.length>49&&console.log("La dirección introducida es muy extensa, se reduce a 50 caracteres.");var n=t.substring(0,49);$("#"+e+"StreetOrUrl").first().val(n),$("#"+e+"Autocomplete").val(n),console.log("streetOrUrl:",n),console.log("street_number:",o.find(function(e){return"street_number"===e.types[0]}).long_name)}catch(e){console.log("error setting street_number")}}function setCountry(e,o){try{$("#"+e+"Country").val($("#"+e+"Country option").filter(function(){return $(this).html().toLowerCase()==o.find(function(e){return"country"===e.types[0]}).long_name.toLowerCase()}).val()),console.log("country:",o.find(function(e){return"country"===e.types[0]}).long_name)}catch(e){console.log("error setting country")}}function setMunicipality(e,o){try{$("#"+e+"Municipality").val($("#"+e+"Municipality option").filter(function(){return $(this).html().toLowerCase()==o.find(function(e){return"locality"===e.types[0]}).long_name.toLowerCase()}).val()),console.log("locality:",o.find(function(e){return"locality"===e.types[0]}).long_name),console.log("administrative_area_level_3",o.find(function(e){return"administrative_area_level_3"===e.types[0]}).long_name)}catch(e){console.log("error setting locality")}}function setProvince(e,o){try{$("#"+e+"Province").val($("#"+e+"Province option").filter(function(){return o.find(function(e){return"administrative_area_level_1"===e.types[0]}).long_name.toLowerCase().includes($(this).html().toLowerCase())?$(this).html().toLowerCase():""}).val()),console.log("administrative_area_level_1:",o.find(function(e){return"administrative_area_level_1"===e.types[0]}).long_name)}catch(e){console.log("error setting administrative_area_level_1")}}function setLocality(e,o){try{$("#"+e+"Locality").val($("#"+e+"Locality option").filter(function(){return $(this).html().toLowerCase()==o.find(function(e){return"administrative_area_level_2"===e.types[0]}).long_name.toLowerCase()}).val()),console.log("administrative_area_level_2:",o.find(function(e){return"administrative_area_level_2"===e.types[0]}).long_name)}catch(e){console.log("error setting administrative_area_level_2")}}function setPostalCode(e,o){try{$("#"+e+"ZipCode").val(o.find(function(e){return"postal_code"===e.types[0]}).long_name),console.log("zip_code:",o.find(function(e){return"postal_code"===e.types[0]}).long_name)}catch(o){$("#"+e+"ZipCode").val(0),console.log("error setting postal_code")}}function setLatitudeAndLongitude(e,o){var t=AddressSupport.GetLocalAddressBySelector(e);t.LongitudeCardinale=o.lng(),t.LatitudeCardinale=o.lat(),AddressSupport.UpdateLocalAddress(e,t),$("#"+e+"Latitude").val(o.lat()),$("#"+e+"Longitude").val(o.lng())}