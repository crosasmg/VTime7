var dict = {
    NewNotification: {
        en: "Have a new notification",
        es: "Tiene una nueva notificación",
        pt: "Tenha uma nova notificação"
    },
    Action: {
        en: "Action",
        es: "Acción",
        pt: "Ação"
    },
    Actions: {
        en: "Actions",
        es: "Acciones"
    },
    ActionTitle: {
        en: "Action title",
        es: "Título de la acción",
        pt: "Título da ação"
    },
    Add: {
        en: "Add",
        es: "Agregar",
        pt: "Adicionar"
    },
    AddTaskSuccess: {
        en: "Task has been added successfully!",
        es: "¡Tarea agregada con éxito!",
        pt: "Tarefa adicionada com sucesso!"
    },
    Transaction: {
        en: "Transaction",
        es: "Transacción",
        pt: "Transação"
    },
    TransactionTitle: {
        en: "Assign a Back Office transaction for a shortcut",
        es: "Asignar una transacción de Back Office para un acceso directo",
        pt: "Atribuir uma transação do Back Office para um atalho"
    },
    AccessDenied: {
        en: "Access denied",
        es: "Acceso denegado",
        pt: "Acesso negado"
    },
    AddWidgetSuccess: {
        en: "Widget has been added successfully!",
        es: "¡Widget agregado con éxito!",
        pt: "Widget adicionado com sucesso!"
    },
    Alerts: {
        en: "Alerts",
        es: "Alertas",
        pt: "Alertas"
    },
    AreYouSure: {
        en: "Are you sure?",
        es: "¿Estás seguro?",
        pt: "Você tem certeza?"
    },
    AssignedTo: {
        en: "Assigned to",
        es: "Asignado a",
        pt: "Atribuído a"
    },
    AssignedToTitle: {
        en: "Is to assign the appointment to one or more users",
        es: "Es para asignar la cita a uno o varios usuarios",
        pt: "É atribuir o compromisso a um ou mais usuários"
    },
    AssignSelectedTasks: {
        en: "Assign selected tasks",
        es: "Asignar tareas seleccionadas",
        pt: "Atribuir tarefas selecionadas"
    },
    AssignSelectedTasksTo: {
        en: "Assign selected tasks to",
        es: "Asignar tareas seleccionadas a",
        pt: "Atribuir tarefas selecionadas a"
    },
    Assignment: {
        en: "Assignment",
        es: "Asignación",
        pt: "Atribuição"
    },
    Available: {
        en: "Available",
        es: "Disponible",
        pt: "Disponível"
    },
    BestTimeToCall: {
        en: "Best time to call",
        es: "Mejor momento para llamar"
    },
    Cancel: {
        en: "Cancel",
        es: "Cancelar",
        pt: "Cancelar"
    },
    CancelNo: {
        en: "Do not",
        es: "No",
        pt: "Não"
    },
    Canceled: {
        en: "Canceled",
        es: "Cancelada",
        pt: "Cancelada"
    },
    DeleteRowConfirmation: {
        en: "Are you sure you want to delete the selected records?",
        es: "¿Está usted seguro de querer eliminar los registros seleccionados?",
        pt: "Tem certeza de que deseja excluir os registros selecionados?"
    },
    ClickToRefreshPage: {
        en: "Click on 'OK' to refresh the page.",
        es: "Haz clic en 'OK' para refrescar la página.",
        pt: "Clique em 'OK' para atualizar a página."
    },
    Close: {
        en: "Close",
        es: "Cerrar",
        pt: "Fechar"
    },
    Code: {
        en: "Code",
        es: "Código",
        pt: "Código"
    },
    Columns: {
        en: "Columns",
        es: "Columnas",
        pt: "Colunas"
    },
    Conditions: {
        en: "Conditions",
        es: "Condiciones",
        pt: "Condições"
    },
    Configuration: {
        en: "Configuration",
        es: "Configuración",
        pt: "Configuração"
    },
    ContinueAnyway: {
        en: "Do you want to continue anyway?",
        es: "¿Deseas continuar de todos modos?",
        pt: "Deseja continuar assim mesmo?"
    },
    Copyright: {
        en: "@2018 InMotion GIT, Inc. All rights reserved",
        es: "@2018 InMotion GIT. Todos los derechos reservados",
        pt: "@2018 InMotion GIT. Todos os direitos reservados"
    },
    Created: {
        en: "Created",
        es: "Creado",
        pt: "Creado"
    },
    CreationDate: {
        en: "Creation date",
        es: "Fecha de creación"
    },
    CreationUser: {
        en: "Creation user",
        es: "Usuario creador"
    },
    DateAndTime: {
        en: "Date and time",
        es: "Fecha y hora",
        pt: "Data e hora"
    },
    Day: {
        en: "Day",
        es: "Día",
        pt: "Dia"
    },
    Deferred: {
        en: "Postponed",
        es: "Pospuesta",
        pt: "Adiada"
    },
    Delete: {
        en: "Delete",
        es: "Eliminar",
        pt: "Excluir"
    },
    DeleteYes: {
        en: "Yes",
        es: "Si",
        pt: "Sim"
    },
    Deleted: {
        en: "Deleted",
        es: "Eliminado",
        pt: "Excluído"
    },
    DeleteTask: {
        en: "Delete task",
        es: "Eliminar la tarea",
        pt: "Excluir a tarefa"
    },
    DeleteTaskSuccess: {
        en: "Task has been deleted successfully!",
        es: "¡Tarea eliminada con éxito!",
        pt: "Tarefa excluída com sucesso!"
    },
    DeleteWidgetSuccess: {
        en: "Widget has been deleted successfully!",
        es: "¡Widget eliminado con éxito!",
        pt: "Widget removido com sucesso!"
    },
    DragAndDropColumnsTitle: {
        en: "Drag the columns you want to select ",
        es: "Arrastre las columnas que desea seleccionar ",
        pt: "Arraste as colunas que deseja selecionar "
    },
    DragAndDropColumnsDescription: {
        en: "(the list of selected columns on the right are those that will be visible in the query).",
        es: "(la lista de columnas seleccionas a la derecha son las que estarán visibles en la consulta).",
        pt: "(a lista de colunas selecionadas à direita são aquelas que serão visíveis na consulta)."
    },
    Edit: {
        en: "Edit",
        es: "Editar"
    },
    EnableSemaphore: {
        en: "Enable semaphore",
        es: "Habilitar semáforo",
        pt: "Habilitar semáforo"
    },
    English: {
        en: "English",
        es: "Inglés",
        pt: "Inglês"
    },
    Error: {
        en: "Error",
        es: "Error"
    },
    ErrorForm: {
        en: "There has been an error sending the form",
        es: "Ha ocurrido un error enviando el formulario"
    },
    ExecuteTransaction: {
        en: "Execute transaction",
        es: "Ejecutar transacción",
        pt: "Executar transação"
    },
    Expiration: {
        en: "Expiration",
        es: "Vencimiento",
        pt: "Vencimento"
    },
    ExpirationDate: {
        en: "Expiration date",
        es: "Fecha de vencimiento"
    },
    ExpiredSession: {
        en: "The session has expired.",
        es: "La sesión ha expirado.",
        pt: "A sessão expirou."
    },
    Extension: {
        en: "Ext.",
        es: "Ext."
    },
    ExtensionNotAllowed: {
        en: "Extension not allowed.",
        es: "Extensión no permitida.",
        pt: "Extensão não permitida."
    },
    ExtensionOne: {
        en: "Ext. 1",
        es: "Ext. 1"
    },
    ExtensionTwo: {
        en: "Ext. 2",
        es: "Ext. 2"
    },
    Field: {
        en: "Field",
        es: "Campo",
        pt: "Campo"
    },
    From: {
        en: "From",
        es: "Desde",
        pt: "De"
    },
    LessThenOrEqualTo100: {
        en: "Enter a value less than or equal to 100.",
        es: "Ingrese un valor menor o igual a 100.",
        pt: "Insira um valor menor ou igual a 100."
    },
    Help: {
        en: "Help",
        es: "Ayuda",
        pt: "Ajuda"
    },
    Home: {
        en: "Home",
        es: "Inicio",
        pt: "Início"
    },
    Hour: {
        en: "Hour",
        es: "Hora",
        pt: "Hora"
    },
    InactivateUser: {
        en: "Inactivate user",
        es: "Inactivar usuario",
        pt: "Inativar usuário"
    },
    InactivateUserSuccess: {
        en: "User inactivated successfully!",
        es: "¡Usuario inactivado con éxito!",
        pt: "Usuário inativado com sucesso!"
    },
    InactiveUserIndicator: {
        en: "The user is already inactive in the period or in part of it!",
        es: "¡El usuario ya está inactivo en el período o en parte de él!",
        pt: "O usuário já está inativado no período ou em parte dele!"
    },
    InvalidExpirationDate: {
        es: "La fecha de expiración no puede ser igual o menor a hoy.",
        en: "The expiration date cannot be the same or less than today.",
        pt: "A data de validade não pode ser igual ou menor que hoje."
    },
    Language: {
        en: "Language",
        es: "Idioma",
        pt: "Idioma"
    },
    LineOfBusiness: {
        en: "Line of business",
        es: "Línea de negocio",
        pt: "Linha de negócio"
    },
    LogIn: {
        en: "Log In",
        es: "Conectar",
        pt: "Entrar"
    },
    LogOut: {
        en: "Log Out",
        es: "Desconectar",
        pt: "Sair"
    },
    Minute: {
        en: "Minute",
        es: "Minuto",
        pt: "Minuto"
    },
    NewPage: {
        en: "New page",
        es: "Nueva página",
        pt: "Nova página"
    },
    NewTask: {
        en: "New task",
        es: "Nueva tarea",
        pt: "Nova tarefa"
    },
    TaskTitle: {
        en: "Task",
        es: "Tarea",
        pt: "Tarefa"
    },
    No: {
        en: "No",
        es: "No",
        pt: "Não"
    },
    NoDataFound: {
        en: "No data found",
        es: "No se han encontrado registros"
    },
    NotAuthorized: {
        en: "Your user is not authorized to access this operation.",
        es: "Su usuario no está autorizado a acceder a esta operación.",
        pt: "Seu usuário não está autorizado a acessar essa operação."
    },
    NotInitiated: {
        en: "Not initiated",
        es: "No iniciada",
        pt: "Não iniciada"
    },
    NoteRequired: {
        en: "Note required",
        es: "Nota requerida"
    },
    NumberDays: {
        en: "Number of days without performing the task",
        es: "Cantidad de días sin atender la tarea",
        pt: "Quantidade de dias sen atender a tarefa"
    },
    Operator: {
        en: "Operator",
        es: "Operador",
        pt: "Operador"
    },
    Operation: {
        en: "Operation",
        es: "Operación",
        pt: "Operação"
    },
    Pending: {
        en: "Pending",
        es: "Pendiente",
        pt: "Pendente"
    },
    PhoneNumber: {
        en: "Phone n°",
        es: "N° telefónico"
    },
    PhoneNumberRequired: {
        en: "Phone number required",
        es: "Número telefónico requerido"
    },
    Phones: {
        en: "Phones",
        es: "Teléfonos"
    },
    Portuguese: {
        en: "Portuguese",
        es: "Portugués",
        pt: "Português"
    },
    PrivacyPolicy: {
        en: "Privacy Policy",
        es: "Política de privacidad",
        pt: "Política de Privacidade"
    },
    Profile: {
        en: "Profile",
        es: "Perfil",
        pt: "Perfil"
    },
    PasswordChange: {
        en: "Password Change",
        es: "Cambio de contraseña",
        pt: "Mudança de senha"
    },
    RecordOwnerRequired: {
        en: "Record owner is required",
        es: "Propietario es requerido"
    },
    RecordOwnerValid: {
        en: "Record owner is invalid",
        es: "Propietario no es válido"
    },
    RequiredField: {
        en: "The field is required.",
        es: "El campo es requerido.",
        pt: "O campo é requerido."
    },
    PageNameMaxLength: {
        en: "The maximum length of the title of the page is 45 characters.",
        es: "La longitud máxima del titulo de la página es de 45 caracteres.",
        pt: "O comprimento máximo do título da página é de 45 caracteres."
    },
    PageOrderMaxLength: {
        en: "The maximum value for ordering the pages is 999.",
        es: "El valor máximo para ordenar las páginas es de 999.",
        pt: "O valor máximo para encomendar as páginas é 999."
    },
    OnlyDigit: {
        en: "The field only allows numerics.",
        es: "El campo sólo permite numéricos.",
        pt: "O campo só permite valores numéricos."
    },
    ResourceNotFound: {
        en: "Resource not found.",
        es: "Recurso no encontrado.",
        pt: "Recurso não encontrado."
    },
    ResourceNotFoundDetail: {
        en: "Sorry, but the resource you are looking for has not been found.",
        es: "Lo sentimos, pero el recurso que está buscando no se ha encontrado.",
        pt: "Desculpe, mas o recurso que está procurando não foi encontrado."
    },
    ResourceUnauthorized: {
        en: "Unauthorized User.",
        es: "Usuario no autorizado.",
        pt: "Usuário não autorizado."
    },
    ResourceUnauthorizedDetail: {
        en: "Sorry, but the resource you are looking for has not been found.",
        es: "Su cuenta no posee los roles necesarios para poder acceder la página indicada.",
        pt: "Sua conta não possui as funções necessárias para acessar a página indicada."
    },
    Save: {
        en: "Save",
        es: "Guardar",
        pt: "Salvar"
    },
    SearchTransaction: {
        en: "Go to",
        es: "Ir a",
        pt: "Ir a"
    },
    Selected: {
        en: "Selected",
        es: "Seleccionado",
        pt: "Selecionado"
    },
    SelectedNodeConditions: {
        en: "(Conditions of the selected node)",
        es: "(Condiciones de la rama seleccionada)",
        pt: "(Condições do nó selecionado)"
    },
    Semaphore: {
        en: "Semaphore",
        es: "Semáforo",
        pt: "Semáforo"
    },
    SemaphoreConfig: {
        en: "Semaphore configuration",
        es: "Configuración del semáforo",
        pt: "Configuração do semáforo"
    },
    Spanish: {
        en: "Spanish",
        es: "Español",
        pt: "Espanhol"
    },
    Status: {
        en: "Status",
        es: "Estado",
        pt: "Estado"
    },
    ///Translate by Scheduler
    TransactionSearch: {
        en: "Click to search transaction",
        es: "Hacer clic para buscar transacción",
        pt: "Clique para pesquisar a transação"
    },
    Subject: {
        en: "Subject",
        es: "Asunto",
        pt: "Assunto"
    },
    SubjectTitle: {
        en: "Name of the appointment or a brief description",
        es: "Nombre de la cita o una breve descripción",
        pt: "Nome do compromisso ou uma breve descrição"
    },
    Location: {
        en: "Location",
        es: "Ubicación",
        pt: "Localização"
    },
    LocationTitle: {
        en: "Meeting place of appointment",
        es: "Lugar de encuentro de la cita",
        pt: "Lugar de reunião de compromisso"
    },
    StartingTime: {
        en: "Starting date",
        es: "Fecha de inicio",
        pt: "Data de início"
    },
    StartingTimeTitle: {
        en: "Time and date where the appointment begins",
        es: "Hora y fecha donde comienza la cita",
        pt: "Hora e data em que o compromisso começa"
    },
    EndingTime: {
        en: "Ending date",
        es: "Fecha de vencimiento",
        pt: "Data de vencimento"
    },
    EndingTimeTitle: {
        en: "Appointment end time and date",
        es: "Hora y fecha de finalización de la cita",
        pt: "Hora e data de término do compromisso"
    },
    Reminder: {
        en: "Reminder",
        es: "Recordatorio",
        pt: "Lembrete"
    },
    ReminderTitle: {
        en: "Time interval to remind the user (s) of the pending appointment",
        es: "Intervalo de tiempo para recordarle al usuario(s) la cita pendiente",
        pt: "Intervalo de tempo para lembrar o (s) usuário (s) do compromisso pendente"
    },
    IndividualTaskIndicator: {
        en: "The task can only be performed by one person",
        es: "La tarea sólo puede ser realizada por una persona",
        pt: "A tarefa pode ser realizada somente por uma pessoa"
    },
    IndividualTaskIndicatorTitle: {
        en: "If this option is enabled, only one user can accept the appointment as completed",
        es: "Si esta opción está habilitada solo un usuario puede aceptar como completada dicha cita",
        pt: "Se esta opção estiver habilitada, somente um usuário pode aceitar o compromisso como concluído"
    },
    WarningWhenCompleted: {
        en: "Send message when the task is completed",
        es: "Mandar mensaje cuando la tarea sea completada",
        pt: "Enviar mensagem quando a tarefa estiver concluída"
    },
    WarningWhenCompletedTitle: {
        en: "If this option is enabled an email will be sent to the user who assigned the appointment",
        es: "Si esta opción está habilitada se le enviará un correo electrónico al usuario que asignó la cita",
        pt: "Se essa opção for ativada, um email será enviado ao usuário que atribuiu o compromisso"
    },
    AllDayActivity: {
        en: "Activate all day",
        es: "Activar todo el dia",
        pt: "Ativar o dia todo"
    },
    AllDayActivityTitle: {
        en: "If this option is enabled, the user must make the appointment throughout the day (24 hours) and the start and end time will not be taken into account",
        es: "Si esta opción está habilitada el usuario deberá de realizar la cita durante todo el día (24 horas) y no se tomará en cuenta la hora de inicio y fin",
        pt: "Se essa opção for ativada, o usuário deverá fazer o compromisso durante o dia (24 horas) e as horas de início e término não serão consideradas"
    },
    OperatorEquals: {
        en: "Equals",
        es: "Es igual a",
        pt: "É igual a"
    },
    OperatorGreaterThan: {
        en: "Greater than",
        es: "Mayor que",
        pt: "Melhor que"
    },
    OperatorGreaterThanOrEqual: {
        en: "Greater than or equal",
        es: "Mayor o igual que",
        pt: "Maior que ou igual"
    },
    OperatorLessThan: {
        en: "Less than",
        es: "Menor que",
        pt: "Menos que"
    },
    OperatorLessThanOrEqual: {
        en: "Less than or equal",
        es: "Menor o igual que ",
        pt: "Menor ou igual"
    },
    Priority: {
        en: "Priority",
        es: "Prioridad",
        pt: "Prioridade"
    },
    PriorityTitle: {
        en: "This appointment will have preference according to the value. The possible values are standard, low and high",
        es: "Esta cita tendrá preferencia según el valor. Los posibles valores son estándar, baja y alta",
        pt: "Esta nomeação terá preferência de acordo com o valor. Os valores possíveis são padrão, baixo e alto"
    },
    Completed: {
        en: "Completed",
        es: "Completada",
        pt: "Concluída"
    },
    CompletedTitle: {
        en: "Calculation of the percentage of completion of the appointment",
        es: "Cálculo de porcentaje de finalización de la cita",
        pt: "Cálculo do percentual de conclusão da consulta"
    },
    See: {
        en: "See",
        es: "Ver"
    },
    TaskMailboxes: {
        en: "Mailboxes",
        es: "Bandejas de tareas",
        pt: "Diretórios de tarefas"
    },
    TaskMailboxesConfig: {
        en: "Mailboxes configuration",
        es: "Configuración de bandejas de tareas",
        pt: "Configuração de diretórios de tarefas"
    },
    TaskMailboxesConfigAdmin: {
        en: "Default mailboxes configuration",
        es: "Configuración de bandejas de tareas por defecto",
        pt: "Configuração de diretórios de tarefas"
    },
    Tasks: {
        en: "Tasks",
        es: "Tareas",
        pt: "Tarefas"
    },
    TransactionNotAllowed: {
        en: "The transaction is not allowed regarding its scheme.",
        es: "La transacción no está permitida para su esquema.",
        pt: "A transação não está permitida para o seu esquema."
    },
    TaskActionTitleDescription: {
        en: "Describe an action",
        es: "Describe una acción",
        pt: "Descreve uma ação"
    },
    TaskAssignmentDescription: {
        en: "Date and time of task creation",
        es: "Fecha y hora de creación de la tarea",
        pt: "Data e hora da criação da tarefa"
    },
    TaskCompletedDescription: {
        en: "Indicates the percentage completed",
        es: "Indica el porcentaje completado",
        pt: "Indica o percentual completado"
    },
    TaskDetail: {
        en: "See task detail",
        es: "Ver detalle de la tarea",
        pt: "Ver detalhe da tarefa"
    },
    TaskExpirationDescription: {
        en: "Date and time of task expiration",
        es: "Fecha y hora de vencimiento de la tarea",
        pt: "Data e hora de vencimento da tarefa"
    },
    TaskHistory: {
        en: "See task history",
        es: "Ver historia de la tarea",
        pt: "Ver historico da tarefa"
    },
    TaskIdentifier: {
        en: "Task identifier",
        es: "Identificador de la tarea",
        pt: "Identificador da tarefa"
    },
    TaskLineOfBusinessDescription: {
        en: "Identify the line of business",
        es: "Identifica la línea de negocio",
        pt: "Identifica a linha de negócio"
    },
    TaskPriorityDescription: {
        en: "Indicates the task importance",
        es: "Indica la importancia de la tarea",
        pt: "Indica a importância da tarefa"
    },
    TaskStatus: {
        en: "Task status",
        es: "Estado de la tarea",
        pt: "Estado da tarefa"
    },
    taskLongDescriptionTitle: {
        en: "A description of the task to be performed",
        es: "Una descripción de la tarea a realizar",
        pt: "Uma descrição da tarefa a ser executada"
    },
    TaskStatusTitle: {
        en: "Possible values are pending, completed, waiting, postponed, canceled",
        es: "Los posibles valores son pendiente, completada, en espera, pospuesta, cancelada",
        pt: "Os valores possíveis estão pendentes, concluídos, aguardando, adiados, cancelados"
    },
    TaskStatusDescription: {
        en: "Current task status",
        es: "Estado actual de la tarea",
        pt: "Estado atual da tarefa"
    },
    TaskSubjectDescription: {
        en: "Describe the task main subject",
        es: "Describe el asunto principal de la tarea",
        pt: "Descreve o assunto principal da tarefa"
    },
    TaskTypeDescription: {
        en: "Indicates the task type",
        es: "Indica el tipo de la tarea",
        pt: "Indica o tipo da tarefa"
    },
    TermsService: {
        en: "Terms of Service",
        es: "Términos de servicio",
        pt: "Termos de Serviço"
    },
    To: {
        en: "To",
        es: "Hasta",
        pt: "Até"
    },
    Type: {
        en: "Type",
        es: "Tipo",
        pt: "Tipo"
    },
    TypeOfPhone: {
        en: "Type of phone",
        es: "Tipo de teléfono"
    },
    //Depreciado se paso a general
    UnexpectedError: {
        en: "Something unexpected has occurred.",
        es: "Ha ocurrido algo inesperado.",
        pt: "Ocorreu algo inesperado."
    },
    UnexpectedErrorDetail: {
        en: "The server encountered something unexpected that didn't allow it to complete the request. We apologize.",
        es: "El servidor encontró algo inesperado que no le permitió completar la solicitud. Pedimos disculpas.",
        pt: "O servidor encontrou algo inesperado que não permitiu completar a solicitação. Pedimos desculpas."
    },
    Update: {
        en: "Update",
        es: "Actualizar",
        pt: "Editar"
    },
    UpdateDate: {
        en: "Update date",
        es: "Fecha de actualización"
    },
    UpdateUser: {
        en: "Update user",
        es: "Usario que actualiza"
    },
    Updated: {
        en: "Updated",
        es: "Actualizado",
        pt: "Editado"
    },
    UpdateTaskStatus: {
        en: "Change task status",
        es: "Cambiar estado de la tarea",
        pt: "Alterar status da tarefa"
    },
    UpdateTaskSuccess: {
        en: "Task has been updated successfully!",
        es: "¡Tarea actualizada con éxito!",
        pt: "Tarefa alterada com sucesso!"
    },
    User: {
        en: "User",
        es: "Usuario",
        pt: "Usuário"
    },
    Value: {
        en: "Value",
        es: "Valor",
        pt: "Valor"
    },
    Yes: {
        en: "Yes",
        es: "Sí",
        pt: "Sim"
    },
    Waiting: {
        en: "Waiting",
        es: "En espera",
        pt: "Em espera"
    },
    WaitingTime: {
        en: "Waiting time",
        es: "Tiempo de espera",
        pt: "Tempo de espera"
    },
    WaitingTimeDescription: {
        en: "Time since the task creation",
        es: "Tiempo transcurrido desde la creación de la tarea",
        pt: "Tempo decorrido desde a criacao da tarefa"
    },
    Week: {
        en: "Week",
        es: "Semana",
        pt: "Semana"
    },
    STSFailureMessage: {
        en: "The STS service is not available.",
        es: "No está disponible el servicio de STS.",
        pt: "O serviço STS não está disponível."
    },
    STSFailureTitle: {
        en: "The STS service is not available.",
        es: "No está disponible el servicio de STS.",
        pt: "O serviço STS não está disponível."
    },
    AutoLogInTitle: {
        en: "Start automatic session",
        es: "Inicio sesión automático",
        pt: "Iniciar sessão automática"
    },
    AutoLogInBody: {
        en: "It will load the current page with find to contextualize the user, it will be automatically recharged",
        es: "Se va cargar la página actual con find de contextualizar el usuario, se va recargara automaticamente",
        pt: "Ele irá carregar a página atual com find para contextualizar o usuário, ele será automaticamente recarregado"
    },
    ConfirmationDeletionPage: {
        en: "Are you sure you want to delete the page?",
        es: "¿Está usted seguro de querer eliminar la página?",
        pt: "Are you sure you want to delete the page?"
    },
    ConfirmationDeletionPageWithWigets: {
        en: "Are you sure you want to delete the page and the widgets it contains?",
        es: "¿Está usted seguro de querer eliminar la página y los widgets que contiene?",
        pt: "Tem certeza de que deseja excluir a página e os widgets que ela contém?"
    },
    ExpiredSessionTitle: {
        en: "Expired session",
        es: "Sesión vencida",
        pt: "Sessão expirada"
    },
    ExpiredSessionBody: {
        en: "Your session has expired, due to safety issues your user is automatically disconnected",
        es: "Su sesión ha vencido, por asunto de seguridad se desconecta automaticamente su usuario",
        pt: "Sua sessão expirou, devido a problemas de segurança, seu usuário é desconectado automaticamente"
    },
    //Depreciado se paso a general
    ExpirationSectionTitle: {
        en: "Session expiration",
        es: "Expiración de sesión",
        pt: "Expiração da sessão"
    },
    //Depreciado se paso a general
    ExpirationSectionBody: {
        en: "Your session will expire and it will redirect in",
        es: "Su sesión se va a vencer y se va a redireccionar al inicio en",
        pt: "Sua sessão expirará e será redirecionada"
    },
    //Depreciado se paso a general
    ExpirationSectionBtnCancel: {
        en: "Close and go to start",
        es: "Cerrar e ir a inicio",
        pt: "Feche e vá para começar"
    },
    //Depreciado se paso a general
    ExpirationSectionBtnSessionKeep: {
        en: "Keep session",
        es: "Mantener sesión",
        pt: "Feche e vá para começar"
    },
    //Depreciado se paso a general
    Seconds: {
        en: "seconds",
        es: "segundos",
        pt: "segundos"
    }
}

var translator = new function () {
    this.translatorObj = null;

    this.initialize = function (language) {
        translator.translatorObj = $('body').translate({ lang: language, t: dict });
    }

    this.changeLanguage = function (language) {
        translator.translatorObj.lang(language);
    }
};
app.core = (function () {
    /**
     * Valor numérico de un control de entrada según limites mínimo y máximo
     * @param {string} url .
     * @param {number} data .
     * @param {number} async .
     * @param {number} overlay .
     * @param {number} success .
     * @param {number} fail .
     * @returns {number} .
     */
    AjaxCallWebMethod = function (url, data, async, overlay, success, fail) {
        var result = null;
        if (overlay)
            $.LoadingOverlay("show");

        $.ajax({
            type: "POST",
            url: url,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            async: async,
            data: data,
            headers: {
                'Accept-Language': generalSupport.LanguageName()
            },
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Bearer " + app.user.token);
            }
        }).done(function (data) {
            var Success = true;
            result = data;
            if (overlay)
                $.LoadingOverlay("hide");
            if (typeof data.d !== 'undefined' && typeof data.d.Success !== 'undefined') {
                if (data.d.Success === false && data.d.Reason !== undefined) {
                    NotifyFail(data.d.Code, data.d.Reason);
                    Success = false;
                }
            }
            if (typeof success !== 'undefined')
                success(data);
        }).fail(function (jqXHR, textStatus, errorThrown) {
            if (overlay)
                $.LoadingOverlay("hide");
            if (typeof fail !== 'undefined')
                fail();
            ErrorHandler(jqXHR, textStatus, errorThrown);
        });
        return result;
    };

    AjaxCall = function (type, url, isSendToken, data, async, overlay, success) {
        if (overlay)
            $.LoadingOverlay("show");
        return $.ajax({
            url: url,
            type: type,
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            async: async,
            cache: false,
            data: data,
            headers: {
                'Accept-Language': generalSupport.LanguageName()
            },
            beforeSend: function (xhr) {
                if (isSendToken == undefined || isSendToken == true) {
                    xhr.setRequestHeader("Authorization", "Bearer " + app.user.token);
                }
            },
            success: function (data) {
                if (overlay)
                    $.LoadingOverlay("hide");
                if (typeof data.d !== 'undefined' && typeof data.d.Success !== 'undefined') {
                    if (data.d.Success === false && data.d.Reason !== undefined)
                        NotifyFail(data.d.Code, data.d.Reason);
                    success(data);
                }
                else
                    success(data);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                if (overlay)
                    $.LoadingOverlay("hide");
                ErrorHandler(jqXHR, textStatus, errorThrown);
            }
        });
    };

    ErrorHandler = function (jqXHR, textStatus, errorThrown) {
        if (jqXHR.status !== 401) {
            var message = '';
            var title = '';
            if (jqXHR.responseJSON !== undefined)
                console.log(jqXHR.responseJSON);
            else
                if (jqXHR.responseText !== undefined) {
                    var result = this.ResponseTextHandler(jqXHR.responseText);
                    if (result.compilation) {
                        title = 'Error de compilación';
                        message = result.detail;
                    }
                }
                else
                    console.log(jqXHR);
            if (message === '' && jqXHR.responseJSON && jqXHR.responseJSON.Code) {
                message = this.ErrorDescription(jqXHR.responseJSON.Code);
            }
            if (message !== '') {
                notification.swal.error(title, message);
            } else {
                notification.swal.error('Ha ocurrido una falla, por favor intente nuevamente', 'si la falla persiste, contacte al personal técnico');
            }
        } else {
            var languajeName = generalSupport.LanguageName();
            if (languajeName == null || languajeName == undefined)
                languajeName = constants.defaultLanguageName;
            notification.swal.infoCallback(dict.NotAuthorized[languajeName], dict.ClickToRefreshPage[languajeName], function () { window.location.reload(true); });
        }
    };

    ResponseTextHandler = function (text) {
        var index = -1;
        var result = { error: null, detail: null, source: null, compilation: false };
        try {
            var compilationError = text.indexOf('<title>Compilation Error</title>') > -1;
            if (compilationError) {
                result.compilation = true;
                result.error = 'Compilation error';
                index = text.indexOf('<b> Compiler Error Message: </b>');
                if (index > -1) {
                    text = text.substring(index + 32);
                }
                index = text.indexOf('<br><br>');
                if (index > -1) {
                    result.detail = $('<div/>').html(text.substring(0, index)).text();
                    text = text.substring(index + 8);
                }
                index = text.indexOf('<code><pre>');
                if (index > -1) {
                    text = text.substring(index + 11);
                }
                index = text.indexOf('Line ');
                if (index > -1) {
                    text = text.substring(index);
                }
                index = text.indexOf('</pre></code>');
                if (index > -1) {
                    result.source = text.substring(0, index);
                    result.source = $('<div/>').html(result.source).text();
                }
                console.error(result);
            }
            else
                console.error(text);
        }
        catch (err) {
            console.error(text);
        }
        return result;
    };

    ErrorDescription = function (code) {
        var result = '';
        $.ajax({
            type: "GET",
            url: constants.fasiApi.base + 'fasi/v1/ErrorMessage?code=' + code + '&languageId=' + generalSupport.LanguageId(),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            async: false,
            data: JSON.stringify({}),
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Bearer " + app.user.token);
            },
            success: function (data) {
                result = data.Data;
            },
            error: function (qXHR, textStatus, errorThrown) {
                result = "Ha ocurrido una falla, por favor intente nuevamente";
            }
        });

        return result;
    };

    NotifyFail = function (code, message) {
        if (code != "401") {
            console.error({ code: code, detail: message });
            if (code === '' || code === undefined) {
                code = '1';
            }

            function ShowMessage() {
                var messageByCatalog = ErrorDescription(code);
                if (messageByCatalog !== '') {
                    notification.swal.error('', messageByCatalog);
                } else {
                    notification.swal.error('', message);
                }
            };

            if (code != "901") {
                ShowMessage();
            } else {
                if (app.user.isAnonymous) {
                    if (!window.location.href.toLowerCase().toString().includes('fasi/dli/queries')) {
                        window.location = '/fasi/default.aspx?GSCode=' + data.authorization.Code;
                    } else {
                        location.reload();
                    }
                }
            }
        } else {
            notification.swal.infoCallback(dict.NotAuthorized[generalSupport.LanguageName()], dict.ClickToRefreshPage[generalSupport.LanguageName()], function () { window.location.reload(true); });
        }
    };

    Setting = function (name) {
        return app.core.SyncWebMethod('/fasi/wmethods/general.aspx/SettingValue', false, JSON.stringify({ name: name })).d;
    };

    return {
        ErrorHandler: function (jqXHR, textStatus, errorThrown) {
            return ErrorHandler(jqXHR, textStatus, errorThrown);
        },
        AsyncWebMethod: function (url, overlay, data, success, fail) {
            return AjaxCallWebMethod(url, data, true, overlay, success, fail);
        },
        SyncWebMethod: function (url, overlay, data, success, fail) {
            return AjaxCallWebMethod(url, data, false, overlay, success, fail);
        },
        AsyncGet: function (url, token, overlay, data, success) {
            return AjaxCall('GET', url, token, data, true, overlay, success);
        },
        SyncGet: function (url, token, overlay, data, success) {
            return AjaxCall('GET', url, token, data, false, overlay, success);
        },
        Get: function (url, overlay, async, token, data, success, fail) {
            return AjaxCall('GET', url, token, data, async, overlay, success);
        },
        /**
         *  Método que realiza el post.
         * @param {any} url URL del operación.
         * @param {any} overlay Si se muerta un ventana de loading.
         * @param {any} async Si el método se dispara async o no.
         * @param {any} token Envía un token para validar la operación.
         * @param {any} data Datos a enviar al method.
         * @param {any} success Función de success.
         * @param {any} fail Función de error.
         * @returns {any} Función que realiza el done
         */
        Post: function (url, overlay, async, token, data, success, fail) {
            return AjaxCall('POST', url, token, data, async, overlay, success);
        },
        Put: function (url, overlay, async, data, success, fail) {
            return AjaxCall('PUT', url, token, data, async, overlay, success);
        },
        Delete: function (url, overlay, async, data, success, fail) {
            return AjaxCall('DELETE', url, token, data, async, overlay, success);
        },
        Setting: function (name) {
            return Setting(name);
        }
    };
})();
var generalSupport = new function () {
    /** Método que obtiene los settings de configuración del web.config - configuration
     * @returns {number} Objeto con los setting de fasi
     */
    this.Settings = function () {
        var result;
        generalSupport.Operation("settings", { id: "" }, function (data) {
            result = data.d;
        });
        return result;
    };

    /**
     * Método que busca un key en objeto dynamic
     * @param {any} root Objecto dynamic
     * @param {any} key Valor a buscar en los keys
     * @returns {any} El valor del key.
     */
    this.findKey = function (root, key) {
        var result;
        if (Array.isArray(root)) {
            result = $.grep(root, function (v) {
                return v.Key === key;
            })[0].Value;
        } else {
            result = root[key];
        }
        return result;
    };

    this.ResourceByKey = function (key) {
        var result = "";
        if (!localStorage.getItem("GeneralResource_" + generalSupport.LanguageName().toLowerCase())) {
            $.ajax({
                url: '/fasi/locales/General.' + generalSupport.LanguageName().toLowerCase() + ".json",
                dataType: 'json',
                data: data,
                async: false,
                success: function (json) {
                    var data = json;
                    localStorage.setItem("GeneralResource_" + generalSupport.LanguageName().toLowerCase(), JSON.stringify(data));
                    result = data.app[key];
                }
            });
        } else {
            var data = JSON.parse(localStorage.getItem("GeneralResource_" + generalSupport.LanguageName().toLowerCase()));
            result = data.app[key];
        }
        return result;
    };

    this.Operation = function (operation, parameters, callBack) {
        app.core.Post('/fasi/wmethods/User.aspx/Operation',
            false,
            false,
            false,
            JSON.stringify({
                operation: operation,
                body: JSON.stringify(parameters)
            }),
            function (data) {
                callBack(data);
            },
            null
        );
    };

    /**
     * Extensiones de jQuery Validate para controles usando en FASI.
     */

    //Initialization
    if (!String.prototype.endsWith) {
        String.prototype.endsWith = function (suffix) {
            return this.indexOf(suffix, this.length - suffix.length) !== -1;
        };
    }

    this.ExtendValidators = function () {
        $.validator.addMethod("AutoNumericRequired", function (value, element) {
            return this.optional(element) || AutoNumeric.getNumber('#' + element.id) !== 0;
        }, "El campo es requerido");
        $.validator.addMethod("AutoNumericMinValue", function (value, element, arg) {
            var result = true;
            if (AutoNumeric.getNumber('#' + element.id) < arg)
                result = false;
            return result;
        });
        $.validator.addMethod("AutoNumericMaxValue", function (value, element, arg) {
            var result = true;
            if (AutoNumeric.getNumber('#' + element.id) > arg)
                result = false;
            return result;
        });
        $.validator.addMethod("DatePicker", function (value, element) {
            var result = true;
            if (!this.optional(element)) {
                if (generalSupport.DatePickerValue('#' + element.id) <= moment(new Date('0001-01-01T00:00:00')).utc())
                    result = false;
            }
            return result;
        });
        $.validator.addMethod("OnlyNumber", function (value, element, arg) {
            var result = true;
            if (!this.optional(element))
                if (!/^[0-9]+$/.test(value))
                    result = false;
            return result;
        }, 'Formato invalido, solo se aceptan dígitos numéricos');
    };

    /**
     * Valor numérico de un control de entrada según limites mínimo y máximo
     * @param {string} inputId Identificador del control de entrada de html
     * @param {number} minimumValueAllowed Valor mínimo permitido
     * @param {number} maximumValueAllowed Valor máximo permitido
     * @returns {number} Valor numérico valido según limites mínimo y máximo
     */
    this.NumericValue = function (inputId, minimumValueAllowed, maximumValueAllowed) {
        var value = AutoNumeric.getNumber(inputId);
        if (value < minimumValueAllowed)
            value = minimumValueAllowed;
        if (value > maximumValueAllowed)
            value = maximumValueAllowed;
        return value;
    };

    Array.prototype.contains = function (obj) {
        var i = this.length;
        while (i--) {
            if (this[i] === obj) {
                return true;
            }
        }
        return false;
    };

    this.LocalStorageRemoveStartWith = function (key) {
        var result = []; // Array to hold the keys
        // Iterate over localStorage and insert the keys that meet the condition into arr
        for (var i = 0; i < localStorage.length; i++) {
            if (localStorage.key(i).indexOf(key) !== -1) {
                result.push(localStorage.key(i));
            }
        }

        // Iterate over arr and remove the items by key
        for (var i = 0; i < result.length; i++) {
            localStorage.removeItem(result[i]);
        }
        //return result;
    };

    this.NormalizeProperties = function (source, properties) {
        var propertyArray;
        if (properties !== "") {
            propertyArray = properties.split(",");
            source.forEach(function (elementSource) {
                for (var prop in elementSource) {
                    var exitProperty = propertyArray.contains(prop);
                    if (exitProperty === true) {
                        var value = elementSource[prop];
                        if (Object.prototype.toString.call(value) === '[object String]' && value.indexOf("Date") !== -1) {
                            elementSource[prop] = generalSupport.ToJavaScriptDate2(value);
                        }
                    }
                }
            });
        }
        return source;
    };

    /** Remover método
     * @return {SessionContext} return el object SessionContext
     */
    this.SessionContext = function () {
        if (!localStorage.getItem('languageId')) {
            localStorage.setItem('languageId', constants.defaultLanguageId);
            localStorage.setItem('languageName', constants.defaultLanguageName);
        }
        return {
            languageId: localStorage.getItem('languageId'),
            clientId: app.user.clientId,
            producerId: app.user.producerId
        };
    };

    /** Remover método
     * @return {UserContext} return el object UserContext
     */
    this.UserContext = function () {
        if (typeof masterSupport !== "undefined" && window.location.pathname.toLowerCase().endsWith('/fasi/default.aspx') == false) {
            masterSupport.Init();
            var data = generalSupport.Settings();
            constantsSupport.setup(data);
        }

        console.warn('Opción sin optimizar');
        if (generalSupport.user === undefined) {
            if (typeof masterSupport !== 'undefined' && typeof masterSupport.user !== 'undefined')
                generalSupport.user = masterSupport.user;
            else
                generalSupport.getUser();
        }

        if (generalSupport.user.languageName.toLowerCase().indexOf("-") !== -1) {
            generalSupport.user.languageName = generalSupport.user.languageName.split('-')[0];
        }

        app.user = generalSupport.user;
        return generalSupport.user;
    };

    /** Remover método
     * @param {any} data data a convertir
     * @return {UserConvert} return el object UserConvert
     */
    this.UserConvert = function (data) {
        return {
            userName: data.username,
            userId: data.userId,
            companyId: data.companyId,
            isAnonymous: data.isAnonymous,
            isAdministrator: data.isAdministrator,
            schemeCode: data.schemeCode,
            token: data.token,
            clientId: data.clientId,
            producerId: data.producerId,
            firstNameAndSecondLastName: data.firstNameAndSecondLastName,
            languageID: data.languageID,
            languageName: data.languageName,
            type: data.type,
            utcOffset: data.utcOffset,
            isEmployee: data.IsEmployee,
            sessionId: data.sessionId,
            expiration: data.expiration,
            timeZoneVT: data.TimeZoneVT
        };
    };

    /** Remover método */
    this.getUser = function () {
        if (window.location.pathname.toLowerCase().endsWith('default.aspx')) {
            generalSupport.user = generalSupport.UserConvert(app.user);
            app.security.TokenInit(app.user.token, true);
        } else {
            console.warn('Opción sin optimizar');
            // Obtiene el código del usuario
            var url = '/fasi/wmethods/User.aspx/GetUserInformation';
            languageName = generalSupport.GetParameterByName('culture');

            if (languageName) {
                url = url + '?culture=' + languageName;
            }

            $.ajax({
                type: "GET",
                url: url,
                contentType: "application/json; charset=utf-8",
                async: false,
                dataType: "json"
            }).done(function (data) {
                    generalSupport.user = generalSupport.UserConvert(data.d);
                    app.user = generalSupport.user;
                    app.security.TokenInit(app.user.token, true);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                if (jqXHR.status == 401) {
                    app.security.EndSession();
                }
            });
        }
        generalSupport.CreateVTTimeZone();
    };

    this.URLDateValue = function (key) {
        var value = generalSupport.URLValue(key);
        if (value !== null)
            value = moment(value, generalSupport.DateFormat()).format(generalSupport.DateFormat());
        return value;
    };

    this.URLNumericValue = function (key) {
        var value = generalSupport.URLValue(key);
        if (value === null)
            value = 0;
        else
            if (isNaN(value))
                value = 0;
            else
                value = parseInt(value);
        return value;
    };

    this.URLStringValue = function (key) {
        var value = generalSupport.URLValue(key);
        if (value === null)
            value = '';
        return value;
    };

    this.URLValue = function (key) {
        key = key.replace(/[\[]/, '\\[');
        key = key.replace(/[\]]/, '\\]');
        var pattern = "[\\?&]" + key + "=([^&#]*)";
        var regex = new RegExp(pattern, "i");
        var url = unescape(window.location.href);
        var results = regex.exec(url);
        if (results === null) {
            return null;
        } else {
            return results[1];
        }
    };

    this.ErrorHandler = function (jqXHR, textStatus, errorThrown, IsDelete) {
        var message = '';
        var isShow = false;
        var title = '';
        if (jqXHR.status !== 401) {
            if (jqXHR.responseJSON !== undefined) {
                //console.log(jqXHR.responseJSON);
                if (jqXHR.responseJSON.Code || jqXHR.responseJSON.Reason) {
                    isShow = true;
                    generalSupport.NotifyFail(jqXHR.responseJSON.Reason, jqXHR.responseJSON.Code, IsDelete);
                }
            }
            else
                if (jqXHR.responseText !== undefined) {
                    var result = this.ResponseTextHandler(jqXHR.responseText);
                    if (result.compilation) {
                        title = 'Error de compilación';
                        message = result.detail;
                    }
                }
                else
                    console.log(jqXHR);
            if (message === '' && jqXHR.responseJSON && jqXHR.responseJSON.Code) {
                message = this.ErrorDescription(jqXHR.responseJSON.Code);
            }
            if (!isShow) {
                if (message !== '') {
                    notification.swal.error(title, message);
                } else {
                    notification.swal.error('Ha ocurrido una falla, por favor intente nuevamente', 'si la falla persiste, contacte al personal técnico');
                }
            }
        } else {
            var languajeName = generalSupport.LanguageName();
            if (languajeName == null || languajeName == undefined)
                languajeName = constants.defaultLanguageName;
            notification.swal.infoCallback(dict.NotAuthorized[languajeName], dict.ClickToRefreshPage[languajeName], function () { window.location.reload(true); });
        }
    };

    this.ResponseTextHandler = function (text) {
        var index = -1;
        var result = { error: null, detail: null, source: null, compilation: false };
        try {
            var compilationError = text.indexOf('<title>Compilation Error</title>') > -1;
            if (compilationError) {
                result.compilation = true;
                result.error = 'Compilation error';
                index = text.indexOf('<b> Compiler Error Message: </b>');
                if (index > -1) {
                    text = text.substring(index + 32);
                }
                index = text.indexOf('<br><br>');
                if (index > -1) {
                    result.detail = $('<div/>').html(text.substring(0, index)).text();
                    text = text.substring(index + 8);
                }
                index = text.indexOf('<code><pre>');
                if (index > -1) {
                    text = text.substring(index + 11);
                }
                index = text.indexOf('Line ');
                if (index > -1) {
                    text = text.substring(index);
                }
                index = text.indexOf('</pre></code>');
                if (index > -1) {
                    result.source = text.substring(0, index);
                    result.source = $('<div/>').html(result.source).text();
                }
                console.error(result);
            }
            else
                console.error(text);
        }
        catch (err) {
            console.error(text);
        }
        return result;
    };

    this.ErrorDescription = function (code) {
        //if (masterSupport.user === null || masterSupport.user === undefined) {
        //    this.getUser();
        //}

        if (code === null) {
            code = "";
        }

        var result = "";

        app.core.Get(constants.fasiApi.base + 'fasi/v1/ErrorMessage?code=' + code + '&languageId=' + generalSupport.LanguageId(),
            false,
            false,
            undefined,
            null,
            function (data) {
                result = data.Data;
            },
            null
        );

        //$.ajax({
        //    type: "GET",
        //    url: constants.fasiApi.base + 'fasi/v1/ErrorMessage?code=' + code + '&languageId=' + generalSupport.LanguageId(),
        //    contentType: "application/json; charset=utf-8",
        //    dataType: "json",
        //    async: false,
        //    data: JSON.stringify({}),
        //    beforeSend: function (xhr) {
        //        xhr.setRequestHeader("Authorization", "Bearer " + app.security.Token());
        //    },
        //    success: function (data) {
        //        result = data.Data;
        //    },
        //    error: function (qXHR, textStatus, errorThrown) {
        //        result = "Ha ocurrido una falla, por favor intente nuevamente";
        //    }
        //});

        return result;
    };

    this.NotifyErrorValidate = function (fvalidate) {
        var errorHtml = '';

        if (fvalidate.numberOfInvalids() > 1) {
            errorHtml = this.ResourceByKey("HasPruralsErrors");
        }
        else {
            errorHtml = this.ResourceByKey("HasSingularErrors");
        }

        errorHtml = errorHtml.replace("{0}", fvalidate.numberOfInvalids());

        notification.toastr.error('', errorHtml);

        var count = fvalidate.errorList.length;
        for (var i = 0; i < count; i++) {
            console.log(fvalidate.errorList[i]['message']);
        }
    };

    this.ToJavaScriptDate2 = function (value) {
        if (value === null)
            return null;
        else {
            var pattern = /Date\(([^)]+)\)/;
            var results = pattern.exec(value);
            if (results !== null) {
                var dt = moment(value);

                if (dt.year() <= 1)
                    return '';
                else
                    return new Date(dt.year(), dt.month(), dt.date());
            }
            else {
                return moment(value, 'YYYY-MM-DD').toDate();
            }
        }
    };

    this.ToJavaScriptDateCustom = function (value, format) {
        var pattern = /Date\(([^)]+)\)/;
        if (value) {
            var results = pattern.exec(value);
            var dt;

            if (results !== null) {
                var x = moment(value);
                if (x.year() <= 1)
                    return '';
                else {
                    //var t = (parseInt(app.user.utcOffset.substring(1, 3), 10) * 60 +
                    //    parseInt(app.user.utcOffset.substring(4, 6), 10) + x.utcOffset()) * -1;
                    //x.add(t, 'm');
                    return x.format(format);
                }
            }
            else {
                var dateFormated;
                var dateValue;
                if (value._isAMomentObject)
                    dateValue = moment(value);
                else {
                    var splitValue = value.split('/')
                    dateValue = moment(splitValue[2] + '-' + splitValue[1] + '-' + splitValue[0])
                }
                if (format !== undefined && format !== null) {
                    dateFormated = moment(value).utc().format(format);
                    if (dateValue.year() === 1) {
                        return '';
                    } else {
                        return dateFormated;
                    }
                }
                else {
                    dateFormated = moment(value);
                    if (dateValue.year() === 1) {
                        return '';
                    } else {
                        return dateFormated;
                    }
                }
            }
        } else {
            return '';
        }
    };

    this.ServerBehavior = function (DataBehavior) {
        if (typeof DataBehavior !== 'undefined' && DataBehavior !== null) {
            if (typeof DataBehavior.controlbehavior !== 'undefined' && DataBehavior.controlbehavior !== null) {
                var ctrolId;
                $.each(DataBehavior.controlbehavior, function () {
                    ctrolId = this['id'];
                    switch (this['property']) {
                        case 'hide':
                            if (ctrolId.endsWith(":Grid")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 5);
                                $('#' + ctrolId + 'Container').toggleClass('hidden', true);
                            }
                            else if (ctrolId.endsWith(":Date")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 5);

                                $('#' + ctrolId).toggleClass('hidden', true);
                                $('#' + ctrolId + '_group').toggleClass('hidden', true);
                                $('#' + ctrolId + 'Label').toggleClass('hidden', true);
                            }
                            else if (ctrolId.endsWith(":Address")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 8);

                                AddressSupport.Visible(ctrolId, false);                                
                            }
                            else {
                                if (ctrolId.endsWith("Wrap"))
                                    ctrolId = ctrolId.substring(0, ctrolId.length - 4);
                                $('#' + ctrolId + 'Label').toggleClass('hidden', true);
                                $('#' + ctrolId + 'Required').toggleClass('hidden', true);
                                if ($('#' + this['id']).next(".select2-container").length > 0) {
                                    $('#' + this['id']).hide();
                                    $('#' + this['id']).next(".select2-container").hide();
                                }
                                else
                                    if ($('#' + this['id']).length > 0)
                                        $('#' + this['id']).toggleClass('hidden', true);
                                    else
                                        $('input:radio[name=' + this['id'] + ']').parent().toggleClass('hidden', true);
                            }
                            break;
                        case 'show':
                            if (ctrolId.endsWith(":Grid")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 5);
                                $('#' + ctrolId + 'Container').toggleClass('hidden', false);
                            }
                            else if (ctrolId.endsWith(":Date")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 5);

                                $('#' + ctrolId).toggleClass('hidden', false);
                                $('#' + ctrolId + '_group').toggleClass('hidden', false);
                                $('#' + ctrolId + 'Label').toggleClass('hidden', false);
                            }
                            else if (ctrolId.endsWith(":Address")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 8);

                                AddressSupport.Visible(ctrolId, true);
                            }
                            else {
                                if (ctrolId.endsWith("Wrap"))
                                    ctrolId = ctrolId.substring(0, ctrolId.length - 4);
                                $('#' + ctrolId + 'Label').toggleClass('hidden', false);
                                $('#' + ctrolId + 'Required').toggleClass('hidden', false);
                                if ($('#' + this['id']).next(".select2-container").length > 0) {
                                    $('#' + this['id']).show();
                                    $('#' + this['id']).next(".select2-container").show();
                                }
                                else
                                    if ($('#' + this['id']).length > 0)
                                        $('#' + this['id']).toggleClass('hidden', false);
                                    else
                                        $('input:radio[name=' + this['id'] + ']').parent().toggleClass('hidden', false);
                            }
                            break;
                        case 'disabled':
                            if (ctrolId.endsWith(":Grid")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 5);
                                $('#' + ctrolId + 'Tbl *, #' + ctrolId + 'Popup .modal-body *, #' + ctrolId + 'Popup .modal-footer *').prop('disabled', true);
                            }
                            else if (ctrolId.endsWith(":Address")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 8);

                                AddressSupport.Enable(ctrolId, false);
                            }
                            else
                                if ($('.nav-tabs a[href="#' + this['id'] + 'Panel"]').length > 0) {
                                    $('#' + this['id']).toggleClass('disabled', true);
                                    $('#' + this['id'] + 'Panel :input').prop('disabled', true);
                                }
                                else
                                    if ($('#' + this['id']).is('div'))
                                        $('#' + this['id'] + ' :input').prop('disabled', true);
                                    else
                                        if ($('#' + this['id']).length > 0)
                                            $('#' + this['id']).prop('disabled', true);
                                        else
                                            $('input:radio[name=' + this['id'] + ']').prop('disabled', true);
                            break;
                        case 'enabled':
                            if (ctrolId.endsWith(":Grid")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 5);
                                $('#' + ctrolId + 'Tbl *, #' + ctrolId + 'Popup .modal-body *, #' + ctrolId + 'Popup .modal-footer *').prop('disabled', false);
                            }
                            else if (ctrolId.endsWith(":Address")) {
                                ctrolId = ctrolId.substring(0, ctrolId.length - 8);

                                AddressSupport.Enable(ctrolId, true);
                            }
                            else
                                if ($('.nav-tabs a[href="#' + this['id'] + 'Panel"]').length > 0) {
                                    $('#' + this['id']).toggleClass('disabled', false);
                                    $('#' + this['id'] + 'Panel :input').prop('disabled', false);
                                }
                                else
                                    if ($('#' + this['id']).is('div'))
                                        $('#' + this['id'] + ' :input').prop('disabled', false);
                                    else
                                        if ($('#' + this['id']).length > 0)
                                            $('#' + this['id']).prop('disabled', false);
                                        else
                                            $('input:radio[name=' + this['id'] + ']').prop('disabled', false);
                            break;

                        case 'active':
                            $('.nav-tabs a[href="#' + this['id'] + 'Panel"]').tab('show');
                            break;

                        case 'click':
                            $('#' + this['id']).click();
                            break;

                        case 'enableColumnLink':
                            $('#' + this['id'] + 'Tbl a').removeClass('DisableColumnLink');
                            break;

                        case 'disableColumnLink':
                            $('#' + this['id'] + 'Tbl a').addClass('DisableColumnLink');
                            break;
                    }
                });
            }
            if (typeof DataBehavior.redirect !== 'undefined' && DataBehavior.redirect !== null && DataBehavior.redirect !== '')
                if (DataBehavior.redirectsetting === null)
                    window.location.href = DataBehavior.redirect;
                else
                    window.open(DataBehavior.redirect.replace("Popup.aspx", "Popup.html"), '_blank', DataBehavior.redirectsetting);
            if (typeof DataBehavior.notify !== 'undefined' && DataBehavior.notify !== null && DataBehavior.notify !== '') {
                if (DataBehavior.notify.splash !== null && DataBehavior.notify.splash !== '')
                    notification.splash.info('', DataBehavior.notify.splash);
                else
                    if (DataBehavior.notify.popup !== null)
                        $.each(DataBehavior.notify.popup, function (index, value) {
                            notification.swal.info('', value);
                        });
                    else {
                        if (DataBehavior.notify.mode !== null || DataBehavior.notify.mode === 'alert') {
                            $("#alerts-container").html('');
                        }
                        if (DataBehavior.notify.messages !== null)
                            if (DataBehavior.notify.messages.length > 1) {
                                if (DataBehavior.notify.mode !== null || DataBehavior.notify.mode === 'alert')
                                    for (i = 0; i < DataBehavior.notify.messages.length; i++) {
                                        notification.alert.error(null, DataBehavior.notify.messages[i].message);
                                    }
                                else {
                                    var errorHtml = '';
                                    for (i = 0; i < DataBehavior.notify.messages.length; i++) {
                                        errorHtml += '<li class=""><label id="' + DataBehavior.notify.messages[i].controlname + '-error" for="' + DataBehavior.notify.messages[i].controlname + '">' + DataBehavior.notify.messages[i].message + '</label></li>';
                                    }
                                    toastr.error(errorHtml, null, {
                                        closeButton: true,
                                        preventDuplicates: true,
                                        progressBar: true,
                                        timeOut: 30000,
                                        extendedTimeOut: 20000,
                                        positionClass: 'toast-top-right'
                                    }).attr('style', 'width: 400px !important');
                                }
                            }
                            else
                                $.each(DataBehavior.notify.messages, function (index, value) {
                                    switch (value.type) {
                                        case 'Error':
                                            notification.swal.error('', value.message);
                                            break;
                                        case 'Warning':
                                            notification.swal.warning('', value.message);
                                            break;
                                        case 'Message':
                                            notification.swal.info('', value.message);
                                            break;
                                    }
                                });
                    }
            }
        }
    };

    this.GetParameterByName = function (name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)", "i");
        results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    };

    this.base64ToArrayBuffer = function (arrayBuffer, filename) {
        var sliceSize = 1024;
        var bytesLength = arrayBuffer.length;
        var sliceCount = Math.ceil(bytesLength / sliceSize);
        var stringFromCharCode = '';
        var begin, end, bytes, sliceIndex, offset;

        for (sliceIndex = 0; sliceIndex < sliceCount; sliceIndex++) {
            begin = sliceIndex * sliceSize;
            end = Math.min(begin + sliceSize, bytesLength);
            bytes = new Array(end - begin);

            for (offset = begin, i = 0; offset < end; ++i, ++offset) {
                bytes[i] = arrayBuffer[offset];
            }
            stringFromCharCode += String.fromCharCode.apply(null, bytes);
        }

        var base64 = btoa(stringFromCharCode);
        var binaryString = atob(base64);
        var binaryLen = binaryString.length;
        sliceCount = Math.ceil(binaryLen / sliceSize);
        var byteArrays = new Array(sliceCount);

        for (sliceIndex = 0; sliceIndex < sliceCount; sliceIndex++) {
            begin = sliceIndex * sliceSize;
            end = Math.min(begin + sliceSize, binaryLen);
            bytes = new Array(end - begin);

            for (offset = begin, i = 0; offset < end; ++i, ++offset) {
                bytes[i] = binaryString.charCodeAt(offset);
            }
            byteArrays[sliceIndex] = new Uint8Array(bytes);
        }

        generalSupport.saveByteArray(byteArrays, filename);
    };

    this.saveByteArray = function (byte, filename) {
        var blob = new Blob(byte);
        var link = document.createElement('a');
        link.href = window.URL.createObjectURL(blob);
        link.download = filename;
        link.click();
    };

    // Transform the date to a format that WCF understands
    this.jsDateToWCF = function (momentDate, dateFormat) {
        return '\/Date(' + moment(momentDate, dateFormat).utc().valueOf() + ')\/';
    };

    this.Select2GetValue = function (name, formated) {
        var result = [];
        var control = $('#' + name);
        var allItem = [],
            adapter = control.data('select2').dataAdapter;
        adapter.$element.children().each(function () {
            if (!$(this).is('option') && !$(this).is('optgroup')) {
                return true;
            }
            allItem.push(adapter.item($(this)));
        });

        if (control.data('select2').options.options.multiple === true) {
            var vales = $('#' + name).select2('data');
            $.each(vales, function (keyDefaul, value) {
                result.push(value);
            });
        }
        $.each(result, function (keyDefaulSelected, valueSelected) {
            valueSelected.selected = true;
        });

        if (formated) {
            var ids = [];
            $.each(result, function (keyDefaulSelected, valueSelected) {
                ids.push(valueSelected.id);
            });
            control.select2('val', '');
            return ids.join(";");
        }
        control.select2('val', '');
        return result;
    };

    this.Select2GetDescription = function (name, formatted, value) {
        var result = [];
        var control = $('#' + name);
        var allItem = [];
        adapter = control.data('select2').dataAdapter;
        adapter.$element.children().each(function () {
            if (!$(this).is('option') && !$(this).is('optgroup')) {
                return true;
            }
            allItem.push(adapter.item($(this)));
        });

        if (formatted) {
            var ids = [];

            if (typeof value === "string") {
                $.each(value.split(";"), function (keyDefaul, valueSplit) {
                    $.each(allItem, function (keyDefaulSelected, valueSelected) {
                        if (valueSelected.id === valueSplit) {
                            ids.push(valueSelected.text);
                        }
                    });
                });
            }

            if (Array.isArray(value)) {
                $.each(value, function (keyDefaul, valueItem) {
                    $.each(allItem, function (key, valueData) {
                        if (valueItem.id === valueData.id) {
                            ids.push(valueData.text);
                        }
                    });
                });
            }

            return ids.join(", ");
        }

        $.each(result, function (keyDefaulSelected, valueSelected) {
            value;
        });

        return result;
    };

    /**
     *
     * @param {any} data array data
     * @param {any} code código a representar el valor de code en el array
     * @param {any} description descripción del código
     * @returns {any} se retorna el array con el formato adecuado para el select2
    */
    this.LookUpConvertArray = function (data, code, description) {
        $.each(data, function (key, value) {
            if (!value.hasOwnProperty('id')) {
                value.id = this[code];
            }
            if (!value.hasOwnProperty('text')) {
                value.text = this[description];
            }
            if (!value.hasOwnProperty('selected')) {
                value.selected = false;
            }
        });
        return data;
    };

    this.Select2Load = function (name, data, code, description, defaultValue, templateResultMethod, templateSelectionMethod) {
        var ctrol = $('#' + name);
        data = generalSupport.LookUpConvertArray(data, code, description);
        $.each(data, function (key, value) {
            ctrol.append($('<option />').val(this['id']).text(this['text']));
        });

        generalSupport.Select2AssignedValue(name, code, data, defaultValue);

        if (templateResultMethod !== null) {
            var fnTemplateResultMethod = window[templateResultMethod];
            var fnTemplateSelectionMethod = window[templateResultMethod];

            ctrol.select2({
                data: data,
                multiple: true,
                allowClear: true,
                templateResult: fnTemplateResultMethod,
                templateSelection: fnTemplateSelectionMethod,
                width: '100%'
            });
        } else {
            ctrol.select2({
                data: data,
                multiple: true,
                allowClear: true,
                width: '100%'
            });
        }

        ctrol.trigger('change');
    };

    this.Select2ItemsRefresh = function (name, defaultValue) {
        var control = $('#' + name);

        var allItem = [],
            adapter = control.data('select2').dataAdapter;
        adapter.$element.children().each(function () {
            if (!$(this).is('option') && !$(this).is('optgroup')) {
                return true;
            }
            allItem.push(adapter.item($(this)));
        });

        var valueSelect = [];

        if (typeof defaultValue === "string") {
            $.each(defaultValue.split(";"), function (keyDefaul, value) {
                valueSelect.push(value.toString());
                $.each(allItem, function (key, valueData) {
                    if (value === valueData.id) {
                        valueData.selected = true;
                        valueSelect.push(valueData.id);
                    }
                });
            });
        }

        if (Array.isArray(defaultValue)) {
            $.each(defaultValue, function (keyDefaul, value) {
                valueSelect.push(value.id.toString());
                $.each(allItem, function (key, valueData) {
                    if (value.id === valueData.id) {
                        valueData.selected = true;
                        valueSelect.push(valueData.id);
                    }
                });
            });
        }

        control.val(valueSelect);

        control.trigger('change');
    };

    this.Select2AssignedValue = function (name, code, data, defaultValue) {
        var ctrol = $('#' + name);

        if (defaultValue !== null) {
            var valueSelect = [];

            if (typeof defaultValue === "string") {
                $.each(defaultValue.split(";"), function (keyDefaul, value) {
                    valueSelect.push(value.toString());
                    $.each(data, function (key, valueData) {
                        if (value === valueData.id) {
                            valueData.selected = true;
                        }
                    });
                });
            }

            if (Array.isArray(defaultValue)) {
                $.each(defaultValue, function (keyDefaul, value) {
                    valueSelect.push(value.Code.toString());
                    $.each(data, function (key, valueData) {
                        if (value[code] === valueData.id) {
                            valueData.selected = true;
                        }
                    });
                });
            }

            ctrol.val(valueSelect);
        }
    };

    this.parseStringToDecimal = function (value, decimalSeparator) {
        if (decimalSeparator === ',') {
            value = value.replace(/\./g, '');
            value = value.replace(',', '.');
        }
        else value = value.replace(/,/g, '');

        return value.replace(/[^0-9\.[^0-9]]/g, '');
    };

    // Este función debe ser eliminada y cambiar el form para que haga el llamado directo usando el notification.js
    this.NotifyFail = function (message) {
        console.error({ code: null, detail: message });
        notification.swal.error('', message);
    };

    /**
     * Método que permite mostrar el manejo de error de forma gráfica
     * @param {any} message Mensaje a mostrar al usuario
     * @param {any} Code Código del error a buscar en el repositorio de lookup de errores
     * @param {any} IsDelete Si es un llamado de un delete se muestra como up pop-up en parte inferior derecha de contrario de muestra un pop-up con swal
     */
    this.NotifyFail = function (message, Code, IsDelete) {
        //Importante por favor revisar con detallle
        var messageByCatalog;
        //console.error({ code: Code, detail: message });
        if (Code != '401') {
            if (Code === '' || Code === undefined || Code === null) {
                Code = '1';
            }

            function ShowMessage() {
                var messageByCatalog = ErrorDescription(Code);
                if (messageByCatalog !== '') {
                    notification.swal.error('', messageByCatalog);
                } else {
                    notification.swal.error('', message);
                }
            };

            if (Code === '777') {
                notification.toastr.error('', message);
            } else if (Code != "901") {
                ShowMessage();
            } else {
                app.security.Logout(app.user.userId, true);
            }
        } else {
            notification.swal.infoCallback(dict.NotAuthorized[generalSupport.LanguageName()], dict.ClickToRefreshPage[generalSupport.LanguageName()], function () { window.location.reload(true); });
        }
    };

    this.TranslateInit = function (name, callback, path) {
        //Translate Configuration Start
        var urlResource = "";
        if (path !== null && path !== undefined) {
            urlResource = "/fasi/" + path + '/locales/__lng__.' + name + '.json';
        } else {
            urlResource = location.href.substring(0, location.href.lastIndexOf("/") + 1) + 'locales/__lng__.' + name + '.json';
        }
        $.i18n.init({
            resGetPath: urlResource,
            load: 'unspecific',
            fallbackLng: false,
            lng: generalSupport.LanguageName() ? generalSupport.LanguageName() : constants.defaultLanguageName
        }, function (t) {
            $('#app').i18n();
            callback.call();
        });
    };

    this.GetCurrentName = function () {
        var url = window.location.pathname;
        var filename = url.substring(url.lastIndexOf('/') + 1);
        filename = filename.replace(".aspx", "");
        filename = filename.replace(".html", "");
        filename = filename.replace("Popup", "");
        return filename;
    };

    this.CallBackOfficePage = function (codispl, parameters) {
        $.ajax({
            type: 'POST',
            url: '/fasi/wmethods/backoffice.aspx/MakeURL',
            contentType: "application/json; charset=utf-8",
            async: false,
            dataType: "json",
            data: JSON.stringify({
                codispl: codispl
            }),
            success: function (data) {
                var win = open(data.d + parameters, '', 'toolbar=no,resizable=no,location=no,directories=no,status=yes,menubar=no,copyhistory=no,width=750,height=450,left=20,top=20');
                if (win !== null) {
                    win.moveTo(0, 0);
                    win.resizeTo(window.screen.availWidth, window.screen.availHeight);
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                generalSupport.ErrorHandler(jqXHR, textStatus, errorThrown);
            }
        });
    };

    this.DatePickerValue = function (id) {
        return $(id).val() !== '' ? moment($(id).val(), generalSupport.DateFormat()) : moment('0001-01-01').format(generalSupport.DateFormat());
    };

    /**
    * Returns the date on UTC and with the given format
    * @param {any} value Object to normalize
    */
    this.DatePickerValueWithValue = function (value) {
        if (value && value.toString().indexOf("Date(") > -1)
            value = generalSupport.ToJavaScriptDateCustom(value, generalSupport.DateFormat());
        return value !== '' ? moment(value, generalSupport.DateFormat()).format('YYYY-MM-DDT00:00:00Z') : moment('0001-01-01').format('YYYY-MM-DDT00:00:00Z');
    };

    this.DatePickerValueInputToObject = function (id, withTime) {
        var result = $(id).val() !== '' ? moment($(id).val(), generalSupport.DateFormat() + 'THH:mm:ss') : moment('0001-01-01');
        var format = 'YYYY-MM-DD';
        if (withTime)
            format = 'YYYY-MM-DDTHH:mm:ssZ';
        return result.format(format);
    };

    this.CreateVTTimeZone = function () {
        if (typeof moment != "undefined" && typeof app.user.timeZoneVT != "undefined") {
            moment.tz.add(moment.tz.pack(app.user.timeZoneVT));
            moment.tz.setDefault("VisualTimeTZ");
        }
    };

    this.DateFormat = function () {
        var result = 'DD/MM/YYYY';
        if (localStorage.getItem('languageName') !== null)
            if (localStorage.getItem('languageName').toLowerCase() === 'en')
                result = 'MM/DD/YYYY';
        return result;
    };

    /**
     * Método que permite darle formato de fecha a un input datepicker incluyendo la hora en el formato.
     * @param {any} id Identificador del input datepicker que va a ser tratado.
     */
    this.DatePickerValueWithHour = function (id) {
        return $(id).val() !== '' ? moment($(id).val(), generalSupport.DateFormatWithHour()) : moment(new Date('0001-01-01T00:00:00Z')).utc();
    };

    /**
     * Método que permite darle formato de fecha a un input datepicker incluyendo la hora en el formato.
     * @param {any} id Identificador del input datepicker que va a ser tratado.
     */
    this.DatePickerWithHourValueInputToObject = function (id) {
        return generalSupport.DatePickerValueWithHour(id).format('YYYY-MM-DDTHH:mm:00');
    };

    /**
     * Método que permite obtener el formato de fecha incluida la hora dependiendo del idioma en el que se encuentra trabajando la aplicación.
     */
    this.DateFormatWithHour = function () {
        var result = 'DD/MM/YYYY HH:mm';
        if (localStorage.getItem('languageName') !== null)
            if (localStorage.getItem('languageName').toLowerCase() === 'en')
                result = 'MM/DD/YYYY HH:mm';
        return result;
    };

    this.DecimalCharacter = function () {
        var result = ',';
        if (localStorage.getItem('languageName') !== null)
            if (localStorage.getItem('languageName').toLowerCase() === 'en' || localStorage.getItem('languageName').toLowerCase() === 'es-mx')
                result = '.';
        return result;
    };

    this.DigitGroupSeparator = function () {
        var result = '.';
        if (localStorage.getItem('languageName') !== null)
            if (localStorage.getItem('languageName').toLowerCase() === 'en' || localStorage.getItem('languageName').toLowerCase() === 'es-mx')
                result = ',';
        return result;
    };

    this.settingsSet = function (settings) {
        localStorage.setItem('settings', JSON.stringify(settings));
    }

    this.settings = function () {
        return JSON.parse(localStorage.getItem('settings'));
    }

    this.LanguageName = function () {
        var result = "";
        if (localStorage.getItem('languageName') !== null) {
            if (localStorage.getItem('languageName').toLowerCase().indexOf("-") !== -1) {
                result = localStorage.getItem('languageName').split('-')[0];
            }
            else {
                result = localStorage.getItem('languageName');
            }
        } else {
            result = constants.defaultLanguageName;
        }

        return result.toLowerCase();
    };

    this.LanguageNameSet = function (languageName) {
        localStorage.setItem('languageName', languageName);
    };

    this.LanguageIdSet = function (languageId) {
        localStorage.setItem('languageId', languageId);
    };

    this.LanguageId = function () {
        if (localStorage.getItem('languageId') !== null) {
            return localStorage.getItem('languageId');
        } else {
            return constants.defaultLanguageId;
        }
    };

    this.LanguageSet = function (languageId, languageName) {
        generalSupport.LanguageIdSet(languageId);
        generalSupport.LanguageNameSet(languageName);
        if (app.user) {
            app.user.languageID = languageId;
            app.user.languageName = languageName;
        }
    };

    this.LanguageSynchronization = function (languageId, languageName) {
        var result = "";
        $.ajax({
            type: 'POST',
            url: '/fasi/wmethods/User.aspx/LanguageSynchronization',
            contentType: "application/json; charset=utf-8",
            async: false,
            dataType: "json",
            data: JSON.stringify({
                languageId: languageId,
                languageName: languageName
            }),
            success: function (data) {
                result = data;
                generalSupport.LanguageSet(data.d.LanguageId, data.d.LanguageName);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                generalSupport.ErrorHandler(jqXHR, textStatus, errorThrown);
            }
        });
        return result;
    };

    this.LanguageByCultureName = function (languageName) {
        var result = "";
        $.ajax({
            type: 'POST',
            url: '/fasi/wmethods/User.aspx/LanguageByCultureName',
            contentType: "application/json; charset=utf-8",
            async: false,
            dataType: "json",
            data: JSON.stringify({
                languageName: languageName
            }),
            success: function (data) {
                if (data.d) {
                    generalSupport.LanguageIdSet(parseInt(data.d.Code));
                    generalSupport.LanguageNameSet(data.d.CultureCode);
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                generalSupport.ErrorHandler(jqXHR, textStatus, errorThrown);
            }
        });
        return result;
    };

    /**
     * Normalize the json dates of the given object. Returns then in UTC
     * @param {any} objectToExamine Object to normalize
     */
    this.NormalizeDatesInObject = function (objectToExamine) {
        for (var propertyToExamine in objectToExamine) {
            if ((objectToExamine[propertyToExamine] !== null) && (objectToExamine[propertyToExamine] !== undefined) && (objectToExamine[propertyToExamine].toString().indexOf("Date") !== -1)) {
                if (objectToExamine[propertyToExamine].toString().indexOf("Date(-") !== -1) {
                    objectToExamine[propertyToExamine] = "0001-01-01T00:00:00" + moment().format('Z');
                } else {
                    //objectToExamine[propertyToExamine] = generalSupport.ToJavaScriptDateCustom(objectToExamine[propertyToExamine], generalSupport.DateFormat());
                    objectToExamine[propertyToExamine] = generalSupport.DatePickerValueWithValue(generalSupport.ToJavaScriptDateCustom(objectToExamine[propertyToExamine], generalSupport.DateFormat()));
                }
            }
        }
        return objectToExamine;
    };

    /**
     * Método que permite achatar el excepciones no controladas.
     * @param {any} errMsg Mensage del error
     * @param {any} url Url de origen
     * @param {any} line Linea de origen
     * @param {any} column Columna de origen
     * @param {any} error Objeto error.
     */
    this.OnError = function (errMsg, url, line, column, error) {
        var objectTrace = {
            Message: errMsg,
            Url: url,
            Line: line,
            Column: column,
            Error: error
        };
        if (url.indexOf("fasi/app/js") !== -1 || url.indexOf("fasi/dli") !== -1) {
            console.error("Uncontrolled error in fasi", objectTrace);
            var key = "";
            try {
                var urlTrace = '/fasi/wmethods/General.aspx/Error';
                $.ajax({
                    type: "POST",
                    async: false,
                    url: urlTrace,
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({
                        Message: objectTrace.Message,
                        Url: objectTrace.Url,
                        Line: objectTrace.Line,
                        Column: objectTrace.Column
                    }),
                    dataType: "json",
                    success: function (data) {
                        key = data.d;
                    },
                    error: function (qXHR, textStatus, errorThrown) {
                        generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
                    }
                });
            } catch (e) {
                console.error("Uncontrolled error in fasi", "Error al realizar trace");
            }
            var item = this.ResourceByKey("ShowDetail");
            item = item.replace("@@key@@", key);
            swal({
                title: this.ResourceByKey("UnexpectedError"),
                html: true,
                text: item,
                type: "error"
            });
        } else {
            console.warn("Uncontrolled error in fasi", objectTrace);
        }
        return true;
    };

    /**
     * Orders the keys in the object
     * @param {any} unordered Unordered object.
     */
    this.OrderKeysOnObject = function (unordered) {
        var ordered = {};
        Object.keys(unordered).sort().forEach(function (key) {
            ordered[key] = unordered[key];
        });

        return ordered;
    };

    /**
     *
     * @param {any} name Nombre del control
     * @param {any} defaultValue Valor de default del select
     * @param {any} source Source que solicita la carga de items
     * @param {any} items Items a popular el select
     * @param {any} isSelect2 Define si es convertible a plugin 'Selected2'
     */
    this.RenderLookUp = function (name, defaultValue, source, items, isSelect2) {
        if (isSelect2 == null) {
            isSelect2 = false;
        }
        var ctrol = $('#' + name);
        if (ctrol.length > 0) {
            if (ctrol.children().length !== 0)
                ctrol.children().remove();
            items = generalSupport.LookUpConvertArray(items, 'Code', 'Description');
            $.each(items, function () {
                ctrol.append($('<option />').val(this['id']).text(this['text']));
            });
            if (defaultValue !== null)
                ctrol.val(defaultValue);
            else
                ctrol.val(0);

            if (isSelect2) {
                ctrol.select2({
                    data: items,
                    multiple: true,
                    allowClear: true,
                    width: '100%'
                });
            }
        } else {
            ctrol = $('#' + name + "_Dynamic");
            if (ctrol.length > 0) {
                ctrol.children().remove();
                items = generalSupport.LookUpConvertArray(items, 'Code', 'Description');
                $.each(items, function () {
                    ctrol.append("<div class='radio'><label><input type='radio' name='" + name + "' id='" + name + "_" + this['Code'] + "' value='" + this['Code'] + "'/>" + this['Description'] + "</label></div>");
                });

                if (isSelect2) {
                    ctrol.select2({
                        sdata: items,
                        multiple: true,
                        allowClear: true,
                        width: '100%'
                    });
                }

                if (typeof defaultValue !== 'undefined' && defaultValue !== null)
                    if (defaultValue.toString() !== (ctrol.val() || '0').toString()) {
                        $($("input:radio[name=" + name + "][value=' + defaultValue + ']")).prop('checked', true);
                    }
            }
        }
    };

    this.SetCalendarPosition = function (calendarSelector) {
        $(calendarSelector).on('dp.show', function () {
            if ($(this).parents(".ibox-content").length > 0) {
                var datePickerChild = $(this).find(".bootstrap-datetimepicker-widget");
                datePickerChild.css({ top: datePickerChild.offset().top, left: datePickerChild.offset().left, height: datePickerChild.outerHeight() });
                datePickerChild.appendTo("body");
                $(this).parents(".ibox-content").css({ overflow: "hidden" });
            }
        }).on('dp.hide', function () {
            if ($(this).parents(".ibox-content").length > 0)
                $(this).parents(".ibox-content").css({ overflow: "" });
        });
    };

    /**
     * Recupera el valor seleccionado de un radiobutton, en caso de no haber nada seleccionado devuelve cero.
     * @param {string} name Nombre del control
     * @return {number} valor seleccionado
     */
    this.RadioNumericValue = function (name) {
        var value = $('input:radio[name=' + name + ']:checked').val();
        if (typeof value === 'undefined' || value === null)
            value = 0;
        return parseInt(0 + value, 10);
    };

    this.CreateNewModal = function (options) {
        //Size to css
        options.cssWidth = options.width > 0 ? { "min-width": (options.width * 0.96) + "%" } : {};
        options.cssHeight = options.height > 0 ? { "height": (options.height) + "%" } : {};

        //Create the modal structure
        var $newModal = $("<div />").attr({ "role": "dialog" }).addClass("modal fade dynamicModal");
        var $modalDialog = $("<div />").attr({ "role": "document" }).addClass("modal-dialog");
        var $modalContent = $("<div />").addClass("modal-content");
        var $modalHeader = $("<div />").addClass("modal-header").html('<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>');
        var $modalBody = $("<div />").addClass("modal-body clearfix");

        //Apply the custom options
        $modalDialog.css(options.cssWidth);
        $modalContent.css(options.cssHeight);
        $modalHeader.append(typeof options.title != "undefined" ? "<h4>" + options.title + "</h4>" : "");

        //Build the modal
        $modalContent.append($modalHeader).append($modalBody);
        $modalDialog.append($modalContent);
        $newModal.append($modalDialog);

        //load teh content
        if (options.isExternal) {
            $modalContent.addClass(options.height > 0 ? "" : "default-size");
            $modalBody.html($("<iframe />").attr({ frameBorder: 0, src: options.url }));
        }
        else {
            $internalContent = $("<div />").addClass("internalContent").load(options.url);
            $internalContent.addClass(options.height > 0 ? "overflow-auto" : "");
            $modalBody.append($internalContent);
        }

        //Display the modal
        $newModal.modal("show");
        $newModal.on('hidden.bs.modal', function () { $newModal.remove() });
    };

    this.CreateNewPopover = function (options, element) {
        //Check that the popover is not on the screen
        if ($("#" + $(element).attr("aria-describedby")).length == 0) {
            //Size to css
            options.cssWidth = options.width > 0 ? { "min-width": options.width } : {};
            options.cssHeight = options.height > 0 ? { "height": options.height } : {};
            options.title = typeof options.title != "undefined" ? options.title : " ";

            if (!options.isExternal)
                $.extend(options.cssHeight, { overflow: "auto" });

            //Create the Popover structure
            var $newPopover = $("<div />").attr({ "role": "tooltip" }).addClass("popover dynamicPopover").css(options.cssWidth).html('<div class="arrow"></div>');
            var $popTitle = $("<h3 />").addClass("popover-title").text(options.title);
            var $popContent = $("<div />").addClass("popover-content").css(options.cssHeight);

            //Build the Popover html
            $newPopover.append($popTitle).append($popContent);

            $(element).attr({
                'data-toggle': "popover",
                'title': options.title,
                'data-content': ""
            });

            $(element).popover({
                template: $newPopover[0].outerHTML
            });

            //Build the Popover
            $(element).popover("show");

            //load teh content
            var popOverInstance = $("#" + $(element).attr("aria-describedby"));
            if (options.isExternal)
                popOverInstance.find(".popover-content").append($("<iframe />").attr({ frameBorder: 0, src: options.url }));
            else
                popOverInstance.find(".popover-content").load(options.url);
        }
    };

    this.ShowOffCanvas = function (options) {
        var $offCanvas;
        var $offCanvasHeader = $("<div />").attr({ id: "off-canvas-header" }).addClass("border-bottom");

        if ($("#off-canvas").length > 0) {
            $offCanvas = $("#off-canvas");
            $offCanvas.empty();
        }
        else
            $offCanvas = $("<div />").attr({ id: "off-canvas" }).addClass("col-sm-3 col-xs-10");

        $offCanvasHeader.append('<button type="button" class="close" id="closeoffCanvas" aria-hidden="true">×</button>');
        if (typeof options.title != "undefined")
            $offCanvasHeader.append('<h2><i class="fa fa-info-circle"></i>' + options.title + '</h2>');

        $offCanvas.append($offCanvasHeader);

        $offCanvas.appendTo("body").show("slide", { direction: "right" }, 300, function () {
            if (options.isExternal)
                $offCanvas.append($("<iframe />").attr({ frameBorder: 0, src: options.url }));
            else
                $offCanvas.append($("<div/>").attr({ id: "off-canvas-content" }).load(options.url));
        });

        $offCanvasHeader.find("#closeoffCanvas").click(function (event) {
            event.preventDefault();
            $offCanvas.hide("slide", { direction: "right" }, 300, function () {
                $offCanvas.remove();
            });
        });
    };

    /**
     * Método que permite hacer un render de un template y dicho valor asignar a un control HTML.
     * @param {any} options Opciones que permite el renda rizado de plantilla
     *                      1. name: define cual es la librería que se va utilizar la rendarizado
     *                      2. context: define la fuente de datos para el remplazo del rendarizado
     *                      3. template: define cual es el cuerpo de la plantilla a utilizar en el rendarizado
     *                      4. element: define sobre cual elemento HTML se va asignar o hacer append del resultado del rendarizado.
     *                      5. IsReplacement: define si se hace un append al HTML del control o se hace un remplazo del body del control a asignar el rendarizado
     */
    this.Render = function (options) {
        var result = RenderBody(options);
        if (!options.IsReplacement) {
            options.IsReplacement = true;
        }
        if (options.IsReplacement) {
            $('#' + options.element).html(result);
        } else {
            $('#' + options.element).append(result);
        }
    };

    /**
     * Método que permite hacer un render de un template y el retorno del body
     * @param {any} options Opciones que permite el renda rizado de plantilla
     *                      1. name: define cual es la librería que se va utilizar la rendarizado
     *                      2. context: define la fuente de datos para el remplazo del rendarizado
     *                      3. template: define cual es el cuerpo de la plantilla a utilizar en el rendarizado
     * @return {result} retorna el valor del rendarizado
     */
    this.RenderBody = function (options) {
        var result = "";
        switch (options.name) {
            case "Template7":
                var compiledTemplate = Template7.compile(options.template);
                result = compiledTemplate(options.context);
                break;
            default:
                break;
        }
        return result;
    };
};

$(function ($) {
    window.onerror = function (errMsg, url, line, column, error) {
        return generalSupport.OnError(errMsg, url, line, column, error);
    };
});

var securitySupport = new function () {
   
    /**Variable para poder utilizar el servido de google recaptcha */
    var keyRecaptcha = "6LfTaj8UAAAAACq2GGmDoAYlEnitqry9_SCHA4gB";

    //Valida los roles de los usuario de estar asignado deja entrar a la planilla
    this.ValidateAccessRoles = function (roles) {
        var urlSource = encodeURI(window.location.pathname);
        var urlUnaunthorizedUser = '/fasi/dli/forms/UnauthorizedUser.aspx?urlsource=' + urlSource;
        var InMotionGITToken = generalSupport.GetParameterByName('InMotionGITToken');
        var user = generalSupport.UserContext();
        if (user.isAnonymous && InMotionGITToken !== null) {
            var resultValidateRole = securitySupport.ValidateRoleByToken(InMotionGITToken, roles);
            if (resultValidateRole) {
                var result = securitySupport.AutoLogIn(InMotionGITToken, constants.defaultLanguageId);
                if (!result) {
                    window.location = urlUnaunthorizedUser;
                }
            } else {
                window.location = urlUnaunthorizedUser;
            }
        } else if (!user.isAnonymous) {
            $.ajax({
                type: "POST",
                async: false,
                url: constants.fasiApi.base + 'Authentication/v1/ValidateAccessRoles',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(roles),
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Bearer " + app.user.token);
                },
                success: function (data) {
                    if (!data.Successfully) {
                        window.location = urlUnaunthorizedUser;
                    }
                },
                error: function (qXHR, textStatus, errorThrown) {
                    window.location = urlUnaunthorizedUser;
                }
            });
        } else if (user.isAnonymous) {
            if (!securitySupport.IsRoleExpecial(roles)) {
                window.location = '/fasi/security/logIn.aspx?urlsource=' + encodeURI(window.location.href);
                //window.location = urlUnaunthorizedUser;
            }
        } else {
            window.location = urlUnaunthorizedUser;
        }
    };

    this.IsRoleExpecial = function (roles) {
        var result = false;
        if (!constants.SpecialRoles) {
            $.ajax({
                type: "GET",
                async: false,
                url: '/fasi/wmethods/User.aspx/SpecialRoles',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    constants.SpecialRoles = data.d;
                },
                error: function (qXHR, textStatus, errorThrown) {
                    generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
                }
            });
        }
        roles.forEach(function (elementSource) {
            if (elementSource == constants.SpecialRoles.AnonymousRole) {
                result = true;
            }
        });
        return result;
    };

    //Define si esta o no conectado el usuario en el aplicación
    this.IsConnected = function () {
        if (generalSupport.UserContext().isAnonymous)
            window.location = '/fasi/security/logIn.aspx?urlsource=' + encodeURI(window.location.href);
        //window.location = constants.defaultPage;
    };

    this.AutoLogIn = function (token, languageId) {
        var result = false;
        $.ajax({
            type: "POST",
            async: false,
            url: '/fasi/wmethods/User.aspx/AutoLogin',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ Token: token, LanguageId: languageId }),
            dataType: "json",
            success: function (data) {
                result = data.d;
            },
            error: function (qXHR, textStatus, errorThrown) {
                generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
            }
        });
        return result;
    };

    this.ValidateRoleByToken = function (token, roles) {
        var result = false;
        var relesValue = roles.join(",");
        $.ajax({
            type: "POST",
            async: false,
            url: constants.fasiApi.base + 'Authentication/v1/ValidateRoleByToken?Token=' + token + "&Roles=" + relesValue,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({ Roles: roles }),
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Bearer " + generalSupport.UserContext().token);
            },
            success: function (data) {
                result = data.Successfully;
            },
            error: function (qXHR, textStatus, errorThrown) {
                generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
            }
        });
        return result;
    };

    this.UserCheckEquals = function (token, userId) {
        var result = false;
        $.ajax({
            type: "POST",
            async: false,
            url: '/fasi/wmethods/User.aspx/UserCheckEquals',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ Token: token, UserId: userId }),
            dataType: "json",
            success: function (data) {
                result = data.d;
            },
            error: function (qXHR, textStatus, errorThrown) {
                generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
            }
        });
        return result;
    };

    this.PasswordRecovery = function () {
        var userName = $('#UserName').val();
        if (userName !== null && userName !== '') {
            $.ajax({
                type: "GET",
                url: constants.fasiApi.members + '/PasswordRecoveryByEmail?email=' + userName,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify({}),
                headers: {
                    'Accept-Language': generalSupport.LanguageName()
                },
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Bearer " + app.user.token);
                },
                success: function (data) {
                    if (data.Successfully === true) {
                        notification.control.success(null, $.i18n.t('app.form.RecoverPasswordSuccessfully'));
                    }
                    else {
                        if (data.Reason != '') {
                            notification.control.error(null, data.Reason);
                        } else {
                            notification.control.error(null, $.i18n.t('app.form.RecoverPasswordIncorrect'));
                        }
                    }
                },
                error: function (qXHR, textStatus, errorThrown) {
                    generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
                }
            });
        } else {
            notification.control.error(null, $.i18n.t('app.form.RequiredEmail'));
        }
    };

    // Desconecta el usuario
    this.Logout = function (userId, IsRedirect, code) {
        //Cleaning the master menu to load the new users one
        localStorage.removeItem("masterMenu");
        ajaxJsonHelper.post(constants.fasiApi.members + 'UserLogOff', null,
            function (data) {
                if (data && data.Successfully) {
                    $.ajax({
                        type: "POST",
                        async: false,
                        url: '/fasi/wmethods/User.aspx/LogOut',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            UserClean();
                            if (IsRedirect) {
                                if (data.d.Url !== "") {
                                    window.location.href = data.d.Url;
                                } else {
                                    if (!code) {
                                        window.location.replace(constants.defaultPage);
                                    }
                                    else {
                                        window.location.href = constants.defaultPage + '?GSCode=' + code;
                                    }
                                }
                            }
                        }
                    });
                }
            }, null, null, false);
    };

    this.SessionLive = function () {
        $.ajax({
            type: "GET",
            async: false,
            url: '/fasi/wmethods/User.aspx/SessionLive',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                console.log(data);
            }
        });
    };

    this.Messages = function (code) {
        var title = "", message = "";
        switch (code) {
            case "GS001":
                title = generalSupport.ResourceByKey("CodeGS001Title");
                message = generalSupport.ResourceByKey("CodeGS001Body");
                break;

            case "901":
                title = generalSupport.ResourceByKey("Code901Title");
                message = generalSupport.ResourceByKey("Code901Body");

                break;
            default:
                title = generalSupport.ResourceByKey("UndefinedTitle");
                message = generalSupport.ResourceByKey("UndefinedMessage");
        }
        notification.swal.info(title, message);
    };

    /**
     * Method de validación por recaptcha de Google
     * @param {any} callbackFuntion Funciona realizar posterior al llamado correcto
     */
    this.CreateCaptcha = function (callbackFuntion) {
        captchaContainer = grecaptcha.render('captcha_container', {
            'sitekey': keyRecaptcha,
            'callback': callbackFuntion,
            "hl": generalSupport.LanguageName()
        });
    };
};

app.security = (function () {
    if (!constants.fields) {
        constants.fields = {};
    }

    if (!constants.fields.security) {
        constants.fields.security = {};
    }

    if (!constants.fields.security.userProfile) {
        constants.fields.security.userProfile = 'userProfile';
    }

    if (!constants.fields.security.masterMenu) {
        constants.fields.security.masterMenu = 'masterMenu';
    }

    if (!constants.fields.security.FASITokenDate) {
        constants.fields.security.FASITokenDate = 'FASITokenDate';
    }

    if (!constants.fields.security.FASIToken) {
        constants.fields.security.FASIToken = 'FASIToken';
    }

    if (!constants.fields.security.unauthorized) {
        constants.fields.security.unauthorized = ' <div class="middle-box-error text-center animated fadeInDown">' +
            '   <h2 id="ResourceNotFound" class="font-bold trn" >{{ResourceUnauthorized}}</h3>' +
            '   <div id="ResourceNotFoundDetail" class="error-desc trn" >{{ResourceUnauthorizedDetail}}</div>' +
            ' </div>';
    }

    UnAuthorized = function () {
        var ResourceUnauthorized = dict.ResourceUnauthorized[app.user.languageName];
        var ResourceUnauthorizedDetail = dict.ResourceUnauthorizedDetail[app.user.languageName];
        var result = constants.fields.security.unauthorized.replace('{{ResourceUnauthorized}}', ResourceUnauthorized).replace('{{ResourceUnauthorizedDetail}}', ResourceUnauthorizedDetail);
        return result;
    };

    Fields = function () {
        return constants.fields;
    };

    UserConvert = function (data) {
        return {
            userName: data.d.user.username,
            userId: data.d.user.userId,
            companyId: data.d.user.companyId,
            isAnonymous: data.d.user.isAnonymous,
            isAdministrator: data.d.user.isAdministrator,
            schemeCode: data.d.user.schemeCode,
            token: data.d.user.token,
            clientId: data.d.user.clientId,
            producerId: data.d.user.producerId,
            firstNameAndSecondLastName: data.d.user.firstNameAndSecondLastName,
            languageID: data.d.user.languageID,
            languageName: data.d.user.languageName,
            type: data.d.user.type,
            utcOffset: data.d.user.utcOffset,
            isEmployee: data.d.user.IsEmployee,
            sessionId: data.d.user.sessionId,
            expiration: data.d.user.expiration,
            timeZoneVT: data.d.user.TimeZoneVT
        };
    };

    WorkerManager = function () {
        if (app.workers) {
            var WorkerRemove = [];
            app.workers.forEach(function (item) {
                WorkerRemove.push(item);
                item();
            });

            WorkerRemove.forEach(function (item) {
                for (var index = app.workers.length - 1; index >= 0; --index) {
                    if (app.workers[index] === item) {
                        app.workers.splice(index, 1);
                    }
                }
            });
            WorkerRemove = [];
        }
    };

    GetUser = function (options, callback) {
        var callBackUser = function (callback) {
            $.ajax({
                url: url,
                type: 'GET',
                contentType: "application/json; charset=utf-8",
            })
                .done(function (data) {
                    app.user = UserConvert(data);
                    TokenInit(app.user.token);
                    callback(data);
                    WorkerManager();
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    serrorFunction();
                });
        };

        if (options == undefined) {
            options = { reset: false };
        }

        if (options.reset === undefined) {
            reset = false;
        }

        if (options.reset === true) {
            localStorage.removeItem(constants.fields.security.userProfile);
        }

        // Obtiene el código del usuario
        var url = '/fasi/wmethods/User.aspx/GetUserInformation';
        languageName = generalSupport.GetParameterByName('culture');

        if (languageName) {
            url = url + '?culture=' + languageName;
        }

        if (!localStorage.getItem(constants.fields.security.userProfile)) {
            callBackUser(callback);
        }
        else {
            app.user = JSON.parse(localStorage.getItem(constants.fields.security.userProfile));
            if (!app.security.SessionIdCheck(app.user.sessionId)) {
                callBackUser(callback);
            }
            else {
                if (!app.security.TokenIsValid()) {
                    TokenInit(app.security.Token(true));
                    callback(app.user);
                } else {
                    callback(app.user);
                }
            }
        }

        /**Se debe remover**/
        if (typeof masterSupport !== 'undefined') {
            masterSupport.user = app.user;
        }

        return app.user;
    };

    UserClean = function () {
        generalSupport.LocalStorageRemoveStartWith(constants.fields.security.masterMenu);
        localStorage.removeItem(constants.fields.security.userProfile);
        generalSupport.LocalStorageRemoveStartWith('Page_');
    };

    MasterMenuKey = function () {
        return constants.fields.security.masterMenu + "_" + generalSupport.LanguageId() + "_" + app.user.userId;
    };

    UserContext = function (options, callback) {
        if (app.user === undefined) {
            if (typeof masterSupport !== 'undefined')
                if (masterSupport !== undefined && masterSupport.user !== undefined) {
                    /** remover ***/
                    app.user = masterSupport.user;
                    generalSupport.user = masterSupport.user;
                }
                else
                    GetUser(options, callback);
            else
                GetUser(options, callback);
        }
        return app.user;
    };

    /**
     * Método para verificar el Id de la session guardado en cache y el que esta en session
     * @param {any} sessionId SessionId actual.
     * @returns {any} Si es igual a actual
     */
    SessionIdCheck = function (sessionId) {
        var result = false;
        var url = '/fasi/wmethods/User.aspx/SessionIdCheck';
        $.ajax({
            type: "POST",
            url: url,
            contentType: "application/json; charset=utf-8",
            async: false,
            data: JSON.stringify({
                sessionId: sessionId
            }),
            dataType: "json",
            success: function (data) {
                result = data.d.State;
            },
            error: function (qXHR, textStatus, errorThrown) {
                result = "Ha ocurrido una falla, por favor intente nuevamente";
            }
        });
        return result;
    };

    SessionCheck = function () {
        if (!app.user.isAnonymous) {
            if (!localStorage.getItem("endTime") || localStorage.getItem("endTime") == "undefined") {
                SessionReset(localStorage.getItem("Interval"));
            }

            localStorage.Timer = setInterval(function () {
                var remaining = Date.parse(localStorage.getItem("endTime")) - new Date();
                if (localStorage.getItem("IsShow") === 'false' && Math.floor(remaining / 1000) <= 30) {
                    var SessionId = "";
                    if (app.user !== null && app.user.sessionId !== null) {
                        SessionId = app.user.sessionId;
                    }
                    generalSupport.Operation("CheckSessionSyncro", { SessionId: SessionId }, function (data) {
                        if (data.d.Valid == false) {
                            swal({
                                title: generalSupport.ResourceByKey("ExpirationSectionTitle"),
                                html: true,
                                text: '<p>' + generalSupport.ResourceByKey("ExpirationSectionBody") + ' <b id="pCounter" name="pCounter"></b> ' + generalSupport.ResourceByKey("Seconds") + '.</p>',
                                type: "warning",
                                buttons: true,
                                dangerMode: true,
                                showCancelButton: true,
                                cancelButtonText: generalSupport.ResourceByKey("ExpirationSectionBtnCancel"),
                                confirmButtonColor: "#18a689",
                                confirmButtonText: generalSupport.ResourceByKey("ExpirationSectionBtnSessionKeep"),
                                closeOnConfirm: true
                            }, function (isConfirm) {
                                if (isConfirm) {
                                    swal.close();
                                    location.reload();
                                } else {
                                    app.security.Logout(app.user.userId, true);
                                    clearInterval(localStorage.Timer);
                                }
                            });

                            localStorage.IsShow = true;
                        } else {
                            app.security.SessionLive();
                            SessionReset(localStorage.getItem("Interval"));
                        }
                    });
                } else if (remaining >= 0) {
                    if ($('#pCounter').length) {
                        $('#pCounter').html(Math.floor(remaining / 1000));
                    }
                } else {
                    app.security.Logout(app.user.userId, true, 'GS001');
                    SessionReset(localStorage.Interval);
                    swal.close();
                    clearInterval(localStorage.Timer);
                }
            }, 1000);
        }
    };

    SessionReset = function (interval) {
        var dt = new Date();
        dt.setSeconds(dt.getSeconds() + parseInt(localStorage.getItem("Interval")) / 1000);
        localStorage.endTime = dt;
        localStorage.IsShow = false;
    };

    Reset = function(interval) {
        localStorage.endTime = + new Date + interval;
        localStorage.IsShow = false;
    };

    SessionSetUp = function (timeout) {
        if (localStorage.getItem("Interval") == "undefined" || localStorage.getItem("Interval") == null) {
            localStorage.setItem("Interval", 60 * 1000 * parseInt(timeout));
            localStorage.setItem("Interval", localStorage.getItem("Interval") - (60 * 400));
        }
    };

    IsALive = function (options, callBack) {
        var InMotionGITToken = generalSupport.GetParameterByName('InMotionGITToken');
        var isFirst = false;
        var roles = [];
        var tokenRenew = false;
        var sessionId = "";
        var isConnected;
        if (options === undefined) {
            options = { reset: false };
        }

        if (options.reset === undefined) {
            reset = false;
        }

        if (options.roles === undefined) {
            roles = [];
        } else {
            roles = options.roles;
        }

        if (options.IsConnected === undefined) {
            isConnected = false;
        } else {
            isConnected = options.IsConnected;
        }

        if (options.reset === true) {
            localStorage.removeItem(constants.fields.security.userProfile);
        }

        if (!localStorage.getItem(constants.fields.security.userProfile)) {
            isFirst = true;
        } else {
            app.user = JSON.parse(localStorage.getItem(constants.fields.security.userProfile));
            sessionId = app.user.sessionId;
            tokenRenew = !TokenIsValid();
        }

        $.ajax({
            url: '/fasi/wmethods/User.aspx/IsALive',
            type: 'POST',
            data: JSON.stringify({
                IsFirst: isFirst,
                SessionId: sessionId,
                TokenRenew: tokenRenew,
                Roles: roles,
                InMotionGITToken: InMotionGITToken,
            }),
            dataType: "json",
            contentType: "application/json; charset=utf-8"
        }).done(function (data) {
            constantsSupport.setup(data.d);
            var FirstPasswordChange = generalSupport.findKey(data.d.settings, "FirstPasswordChange");
            if (data.d.user) {
                app.user = UserConvert(data);
                TokenInit(app.user.token);
            }
            else if (data.d.token) {
                TokenInit(data.d.token);
            }

            var timeout = generalSupport.findKey(data.d.settings, "timeout");
            var languageId = generalSupport.findKey(data.d.settings, "LanguageId");
            var languageName = generalSupport.findKey(data.d.settings, "LanguageName"); 

            generalSupport.settingsSet(data.d.settings); 

            SessionSetUp(timeout);

            generalSupport.LanguageSet(languageId, languageName);

            if (!app.user.isAnonymous) {
                SessionReset(timeout);
            }

            if (typeof masterSupport !== 'undefined') {
                masterSupport.user = app.user;
                generalSupport.user = app.user;
                if (!isFirst && sessionId !== app.user.sessionId) {
                    UserClean();
                }
                masterSupport.Enviroment();
            }

            if (!data.d.user) {
                data.d.user = app.user;
            }

            function LocalInit() {
                if (callBack !== undefined) {
                    if (isConnected) {
                        app.security.IsConnected();
                        callBack(data);
                        app.security.SessionCheck();
                    }
                    else {
                        if (data.d.authorization.Successfully) {
                            callBack(data);
                        } else {
                            ValidateAccess(data.d);
                        }
                        app.security.SessionCheck();
                    }
                } else {
                    if (isConnected) {
                        app.security.IsConnected();
                    } else {
                        if (data.d.authorization) {
                            ValidateAccess(data.d);
                        }
                    }
                    app.security.SessionCheck();
                }

                WorkerManager();
                generalSupport.CreateVTTimeZone();
            }

            if (FirstPasswordChange == false) {
                LocalInit();
            }
            else {
                var FirstPasswordChangeUrl = generalSupport.findKey(data.d.settings, "FirstPasswordChangeUrl");
                if (window.location.pathname.toLowerCase().indexOf(FirstPasswordChangeUrl.toLowerCase()) != 0) {
                    window.location = FirstPasswordChangeUrl;
                } else {
                    LocalInit();
                }
            }
        }).fail(function (jqXHR, textStatus, errorThrown) {
            if (jqXHR.status == 401) {
                EndSession();
            } else {
                app.core.ErrorHandler(jqXHR, textStatus, errorThrown);
            }
        });
    };

    ValidateAccess = function (data) {
        var urlSource = encodeURI(window.location.pathname);
        var urlUnaunthorizedUser = '/fasi/dli/forms/UnauthorizedUser.aspx?urlsource=' + urlSource;
        var InMotionGITToken = generalSupport.GetParameterByName('InMotionGITToken');
        if (data.user.isAnonymous && InMotionGITToken !== null) {
            var resultValidateRole = securitySupport.ValidateRoleByToken(InMotionGITToken, roles);
            if (resultValidateRole) {
                var result = securitySupport.AutoLogIn(InMotionGITToken, constants.defaultLanguageId);
                if (!result) {
                    window.location = urlUnaunthorizedUser;
                }
            } else {
                window.location = urlUnaunthorizedUser;
            }
        } else if (!data.user.isAnonymous) {
            if (!data.authorization.Successfully) {
                window.location = urlUnaunthorizedUser;
            }
        } else if (data.user.isAnonymous) {
            var code = generalSupport.GetParameterByName('GSCode');
            if (!data.authorization.Successfully && code == null) {
                window.location = '/fasi/default.aspx?GSCode=' + data.authorization.Code;
            }
        } else {
            window.location = urlUnaunthorizedUser;
        }
    };

    Authorization = function (options, callBack) {
        if (options.IsConnected !== undefined) {
            if (app.user.isAnonymous) {
                options.Element.html(UnAuthorized());
            } else {
                callBack();
            }
        } else {
            if (options.roles === undefined) {
                options.roles = [];
            }
            $.ajax({
                url: '/fasi/wmethods/User.aspx/Authorization',
                type: 'POST',
                data: JSON.stringify({
                    Roles: options.roles
                }),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Bearer " + app.user.token);
                }
            }).done(function (data) {
                if (!data.d.Successfully) {
                    options.Element.html(UnAuthorized());
                }
                else {
                    callBack();
                }
            }).fail(function (jqXHR, textStatus, errorThrown) {
                serrorFunction();
            });
        }
    };

    PageSetup = function (options) {
        if (options.Pathname.toLowerCase().endsWith('default.aspx')) {
            app.security.Authorization(options, options.CallBack);
        }
        else
            if (options.Pathname.toLowerCase().endsWith('popup.html'))
                app.security.IsALive(options, options.CallBack);
            else {
                if (!options.Custom && options.Custom == false) {
                    app.workers.push(options.CallBack);
                    masterSupport.Init(options);
                } else {
                    app.security.IsALive(options, options.CallBack);
                }
            }
    };

    EndSession = function () {
        clearInterval(localStorage.Timer);
        localStorage.clear();
        window.location.replace(constants.defaultPage);
    };

    Logout = function (userId, IsRedirect, code) {
        //Cleaning the master menu to load the new users one
        app.core.Post(constants.fasiApi.members + 'UserLogOff',
            true,
            false,
            undefined,
            false,
            function (data) {
                if (data && data.Successfully) {
                    $.ajax({
                        type: "POST",
                        async: false,
                        url: '/fasi/wmethods/User.aspx/LogOut',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            UserClean();
                            clearInterval(localStorage.Timer);
                            localStorage.clear();
                            if (IsRedirect) {
                                if (data.d.Url !== "") {
                                    window.location.href = data.d.Url;
                                } else {
                                    if (!code) {
                                        window.location.replace(constants.defaultPage);
                                    }
                                    else {
                                        window.location.href = constants.defaultPage + '?GSCode=' + code;
                                    }
                                }
                            }
                        }
                    });
                }
            },
            null
        );
    };

    IsConnected = function () {
        if (app.user.isAnonymous)
            window.location = '/fasi/security/logIn.aspx?urlsource=' + encodeURI(window.location.href);
    };

    IsRoleExpecial = function (roles) {
        var result = false;
        if (!constants.SpecialRoles) {
            $.ajax({
                type: "GET",
                async: false,
                url: '/fasi/wmethods/User.aspx/SpecialRoles',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    constants.SpecialRoles = data.d;
                },
                error: function (qXHR, textStatus, errorThrown) {
                    generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
                }
            });
        }
        roles.forEach(function (elementSource) {
            if (elementSource == constants.SpecialRoles.AnonymousRole) {
                result = true;
            }
        });
        return result;
    };

    UserCheckEquals = function (token, userId) {
        var result = false;
        $.ajax({
            type: "POST",
            async: false,
            url: '/fasi/wmethods/User.aspx/UserCheckEquals',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ Token: token, UserId: userId }),
            dataType: "json",
            success: function (data) {
                result = data.d;
            },
            error: function (qXHR, textStatus, errorThrown) {
                generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
            }
        });
        return result;
    };

    AutoLogIn = function (token, languageId) {
        var result = false;
        $.ajax({
            type: "POST",
            async: false,
            url: '/fasi/wmethods/User.aspx/AutoLogin',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ Token: token, LanguageId: languageId }),
            dataType: "json",
            success: function (data) {
                result = data.d;
            },
            error: function (qXHR, textStatus, errorThrown) {
                generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
            }
        });
        return result;
    };

    SessionLive = function () {
        $.ajax({
            type: "GET",
            async: false,
            url: '/fasi/wmethods/User.aspx/SessionLive',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                console.log(data);
            }
        });
    };

    /**
     * Devuelve el token de acceso de FASI tomando en cuenta la vigencia de 30 min del mismo.
     * @param {boolean} force define si se reset el token o no
     * @returns {string} Token de acceso de BeAware
     */
    Token = function (force) {
        var result = '';

        //if (force === undefined) {
        //    force = false;
        //}

        //var callBack = function () {
        //    result = CreateToken();
        //    TokenInit(result);
        //    return result;
        //};

        //if (!TokenIsValid()) {
        //    result = callBack();
        //}
        //else {
        result = localStorage.getItem(constants.fields.security.FASIToken);
        //    if (result === "") {
        //        result = callBack();
        //    }
        //}
        return result;
    };

    /**
    * Define si un token es valido o no
    * @returns {string} retorna el estado del token
    */
    TokenIsValid = function () {
        var result = false;
        if (localStorage.getItem(constants.fields.security.FASITokenDate)) {
            result = (new Date().getTime() - new Date(localStorage.getItem(constants.fields.security.FASITokenDate)).getTime()) / 60000 < 5;
        }
        return result;
    };

    /**
    * Inicia-liza la variables para el localStorage de token
    * @param {string} token Token de acceso de FASI
    * @param {boolean} reset Resetea la feccah
    */
    TokenInit = function (token, reset) {
        localStorage.setItem(constants.fields.security.FASITokenDate, new Date());
        localStorage.setItem(constants.fields.security.FASIToken, token);
        app.user.token = token;
        localStorage.setItem(constants.fields.security.userProfile, JSON.stringify(app.user));
    };

    /**
    * Devuelve el token de acceso de FASI sin manejo de cache.
    * @returns {string} Token de acceso de Fasi
    */
    CreateToken = function () {
        var result = '';
        $.ajax({
            type: "POST",
            async: false,
            url: '/fasi/wmethods/User.aspx/Token',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                result = data.d.Token;
            },
            error: function (qXHR, textStatus, errorThrown) {
                generalSupport.ErrorHandler(qXHR, textStatus, errorThrown);
            }
        });
        TokenInit(result);
        return result;
    };

    AuthorizationProcess = function (data) {
        if (!app.user.isAnonymous) {
            var ee = window.location;
        } else {
            var rr = window.location;
        }
    }


    return {
        //GetUser: function (options) {
        //    return GetUser(options);
        //},
        GetUser: function (options, callback) {
            GetUser(options, callback);
        },
        GetUser2: function (options) {
            var callback = function () {
                masterSupport.Enviroment();
            };
            return GetUser2(options, callback);
        },
        Fields: function () {
            return constants.fields;
        },
        UserClean: function () {
            UserClean();
        },
        EndSession: function () {
            return EndSession();
        },
        UserContext: function (options) {
            return app.user;
            //var callback = function () {
            //    if (typeof masterSupport !== 'undefined') {
            //        masterSupport.Enviroment();
            //    }
            //};
            //return UserContext(options, callback);
        },
        SessionIdCheck: function (sessionId) {
            return SessionIdCheck(sessionId);
        },
        SessionCheck: function () {
            return SessionCheck();
        },
        SessionReset: function (interval) {
            return SessionReset(interval);
        },
        SessionSetUp: function (timeout) {
            SessionSetUp(timeout);
        },
        Logout: function (userId, IsRedirect, code) {
            Logout(userId, IsRedirect, code);
        },
        IsConnected: function () {
            IsConnected();
        },
        IsRoleExpecial: function (roles) {
            return IsRoleExpecial(roles);
        },
        UserCheckEquals: function (token, userId) {
            return UserCheckEquals(token, userId);
        },
        AutoLogIn: function (token, languageId) {
            return AutoLogIn(token, languageId);
        },
        SessionLive: function () {
            return SessionLive();
        },
        Token: function (force) {
            return Token(force);
        },
        TokenIsValid: function () {
            return TokenIsValid();
        },
        TokenInit: function (token, reset) {
            TokenInit(token, reset);
        },
        IsALive: function (options, callBack) {
            return IsALive(options, callBack);
        },
        Authorization: function (options, callBack) {
            return Authorization(options, callBack);
        },
        PageSetup: function (options) {
            PageSetup(options);
        },
        MasterMenuKey: function () {
            return MasterMenuKey();
        },
        AuthorizationProcess: function (data) {
            return AuthorizationProcess(data);
        }
    };
})();