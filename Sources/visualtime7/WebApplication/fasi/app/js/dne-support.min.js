var richTextOptions={height:150,minHeight:150,maxHeight:150,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript","fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]]],dialogsInBody:!0,disableDragAndDrop:!0},DNESupport=new function(){var t=!1,e="",o="",n=0,i=0,r=0;this.DNEEditCommandFormatter=function(t,e){return'<a href="javascript:void(0)" class="" title='+$.i18n.t("DNEControl.form.Edit")+">"+t+"</a>"},this.DNEDownloadFile=function(t,e){generalSupport.base64ToArrayBuffer(t,e)},this.DNEAttachmentAddModalEvent=function(t){$("#"+t+"CreateBtn").off().click(function(e){var o=$("#"+t+"AddModal");o.find("#"+t+"DNEFileDescription, #"+t+"DNEFileExpirationDate").val(""),o.find("#"+t+"DNEFileInput").fileinput("refresh").fileinput("enable").fileinput("clear"),o.modal("show")})},this.DNEIsUserSuscriptor=function(){return $.ajax({type:"POST",url:"/fasi/wmethods/User.aspx/IsUserSuscriptor",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){t=e.d}})},this.DNEGetProvider=function(){return $.ajax({type:"POST",url:"/fasi/wmethods/General.aspx/SettingValue",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({name:"DNEProvider"}),success:function(t){e=t.d}})},this.DNEGetUrl=function(){return $.ajax({type:"POST",url:"/fasi/wmethods/General.aspx/SettingValue",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({name:"DNE.URL"}),success:function(t){o=t.d}})},this.DNERefreshButtonEvent=function(t,e,o,n){$("#"+t+"RefreshBtn").off().click(function(i){DNESupport.DNERetrieveData(t,e,o,n)})},this.DNERetrieveData=function(t,n,i,r){$.LoadingOverlay("show");var a=DNESupport.DNEGetRetrieveOperation(r),d=$("#"+t+"SequenceId").val();return $.ajax({type:"POST",url:o+a,contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,headers:{"Accept-Language":generalSupport.LanguageName()},data:JSON.stringify({sequenceId:""===d?0:d,shortTags:i,selectNotesOnly:n,provider:e}),beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+app.user.token)},success:function(e){0===n?(DNESupport.DNEAttachmentAddModalEvent(t),$("#"+t+"Tbl").bootstrapTable("load",e)):DNESupport.DNEDrawNotes(t,e,r)},error:function(t,e,o){generalSupport.ErrorHandler(t,e,o)},complete:function(){$.LoadingOverlay("hide")}})},this.DNEDrawNotes=function(t,e,o){var n="",i="",r="",a="";$.each(e,function(e,o){r=null!==o.UpdateDate?generalSupport.ToJavaScriptDateCustom(o.UpdateDate,generalSupport.DateFormat()):"",a=null!==o.CreationDate?generalSupport.ToJavaScriptDateCustom(o.CreationDate,generalSupport.DateFormat()):"",i=null!==o.ExpirationDate?generalSupport.ToJavaScriptDateCustom(o.ExpirationDate,generalSupport.DateFormat()):"",n+='<li class="'+(!0&e?"info":"success")+'-element note-element-form-designer" id="'+o.ConsequenceId+'"><div class="note"><h4 class="noteDescription">'+o.Description+'</h4><div class="noteContent">'+(null!==o.Note?o.Note.Content:"")+'</div></div><div class="note-footer-element-form-designer"><hr><i class="fa fa-clock-o"></i> '+$.i18n.t("DNEControl.form.UpdateDate")+": "+r+'<br><i class="fa fa-user"></i> '+$.i18n.t("DNEControl.form.UpdateUser")+": "+o.UpdateUserName+'<br><i class="fa fa-clock-o"></i> '+$.i18n.t("DNEControl.form.CreationDate")+": "+a+'<br><i class="fa fa-user"></i> '+$.i18n.t("DNEControl.form.CreationUser")+": "+o.CreatorUserName+'<br><i class="fa fa-clock-o expirationDate" data-expirationdate="'+i+'"></i> '+$.i18n.t("DNEControl.form.ExpirationDate")+": "+i+'<a href="#" class="pull-right btn btn-xs btn-danger '+t+'NoteDelete"><i class="fa fa-trash"></i> '+$.i18n.t("DNEControl.form.Delete")+'</a><a href="#" class="pull-right btn btn-xs btn-primary '+t+'NoteEdit"><i class="fa fa-pencil-square-o"></i> '+$.i18n.t("DNEControl.form.Edit")+'</a><a href="#" class="pull-right btn btn-xs btn-default '+t+'NoteSee"><i class="fa fa-search"></i> '+$.i18n.t("DNEControl.form.See")+"</a></div></li>"}),$("#"+t+"NoteList").empty().append(n),$("."+t+"NoteEdit").off().click(function(o){DNESupport.DNENoteEditEvent(t,e,$(this).parent().parent())}),$("."+t+"NoteDelete").off().click(function(e){DNESupport.DNENoteDeleteEvent(t,$(this).parent().parent().attr("id"),o)}),$("."+t+"NoteSee").off().click(function(){DNESupport.DNENoteSeeEvent(t,$(this).parent().parent())})},this.DNENoteSeeEvent=function(t,e){var o=$("#"+t+"SeeModal");o.find("#"+t+"SeeModalNoteContent").html(e.find(".noteContent").html()),o.css("word-break","break-all"),o.modal("show")},this.DNENoteEditEvent=function(t,e,o){var n=$("#"+t+"EditModal"),i=n.find("#"+t+"EditModalDescription"),r=n.find("#"+t+"EditExpirationDate"),a=n.find("#"+t+"EditModalNoteContent"),d=($("#"+t+"SequenceId").val(),o.attr("id"));i.val(o.find(".noteDescription").text()),r.val(o.find(".expirationDate").data("expirationdate")),a.summernote("code",o.find(".noteContent").html()),n.modal("show"),$("#"+t+"EditModalBtn").off().click(function(o){var l=e.filter(function(t){return t.Note.ConsequenceId.toString()===d})[0];if(l.Description=i.val(),l.Note.Content=a.summernote("code"),""===l.Description)toastr.error($.i18n.t("DNEControl.validation.DescriptionCannotBeEmpty"),"",{positionClass:"toast-bottom-right"});else if(l.Description.length>100)toastr.error($.i18n.t("DNEControl.validation.DescriptionCannotBeEmpty"),"",{positionClass:"toast-bottom-right"});else if(""===r.val()||moment(r.val(),generalSupport.DateFormat()).isAfter(moment(new Date))){try{l.ExpirationDate=""!==r.val()?generalSupport.jsDateToWCF(r.val(),generalSupport.DateFormat()):null}catch(o){l.ExpirationDate="",console.log("invalid date")}DNESupport.DNEEditResource(l).done(function(){DNESupport.DNERefreshGrid(t),n.modal("hide")})}else toastr.error($.i18n.t("DNEControl.validation.InvalidExpirationDate"),"",{positionClass:"toast-bottom-right"})})},this.DNENoteDeleteEvent=function(t,e,o){var n=$("#"+t+"DeleteModal"),i={SequenceId:$("#"+t+"SequenceId").val(),ConsequenceId:e};n.modal("show"),$("#"+t+"DeleteModalBtn").off().click(function(e){DNESupport.DNEDeleteResource(i,DNESupport.DNEGetDeleteOperation(o)).done(function(){DNESupport.DNERefreshGrid(t),n.modal("hide")})})},this.DNEAddNoteEvent=function(t,e,o){var n=$("#"+t+"AddModalNoteContent");n.off().summernote(richTextOptions),$("#"+t+"CreateBtn").off().click(function(i){var r=$("#"+t+"AddModal");r.find("#"+t+"AddModalDescription").val(""),r.find("#"+t+"AddModalExpirationDate").val(""),n.summernote("code",""),r.modal("show"),$("#"+t+"AddModalBtn").off().click(function(){var i=$("#"+t+"SequenceId").val(),a={SequenceId:i,Content:n.summernote("code")},d={SequenceId:i,Description:$("#"+t+"AddModalDescription").val(),ResourceTypeId:5,ClientAssociatedCompany:"1",ClientAssociatedPerson:"1",Name:$("#"+t+"AddModalDescription").val(),Tags:e,Note:a,ExpirationDate:r.find("#"+t+"AddModalExpirationDate").val()};if(""===d.Description)toastr.error($.i18n.t("DNEControl.validation.DescriptionCannotBeEmpty"),"",{positionClass:"toast-bottom-right"});else if(d.Description.length>100)toastr.error($.i18n.t("DNEControl.validation.DescriptionCannotBeEmpty"),"",{positionClass:"toast-bottom-right"});else if(""===d.ExpirationDate||moment(d.ExpirationDate,generalSupport.DateFormat()).isAfter(moment(new Date))){try{d.ExpirationDate=""!==d.ExpirationDate?generalSupport.jsDateToWCF(d.ExpirationDate,generalSupport.DateFormat()):null}catch(t){d.ExpirationDate="",console.log("invalid date")}"0"!==i.toString()?DNESupport.DNEAddResource(t,d,DNESupport.DNEGetAddOperation(o)).done(function(){r.modal("hide"),DNESupport.DNERefreshGrid(t)}):DNESupport.DNEGetSequenceId(t).done(function(e){a.SequenceId=e,d.SequenceId=e,DNESupport.DNEAddResource(t,d,DNESupport.DNEGetAddOperation(o)).done(function(){r.modal("hide"),DNESupport.DNERefreshGrid(t)})})}else toastr.error($.i18n.t("DNEControl.validation.InvalidExpirationDate"),"",{positionClass:"toast-bottom-right"})})})},this.DNEGetSequenceId=function(t){return $.ajax({type:"GET",url:o+"GenerateSequence",contentType:"application/json; charset=utf-8",dataType:"json",data:{provider:e},beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+app.user.token)},success:function(e){$("#"+t+"SequenceId").val(e)},error:function(t,e,o){generalSupport.ErrorHandler(t,e,o)},complete:function(){$.LoadingOverlay("hide")}})},this.LoadTextOnForm=function(t,e){$("#"+t+"Tbl").find("th[data-field='Name']").find("div").first().html($.i18n.t("DNEControl.form.Name")),$("#"+t+"Tbl").find("th[data-field='Description']").find("div").first().html($.i18n.t("DNEControl.form.Description")),$("#"+t+"Tbl").find("th[data-field='ResourceTypeId']").find("div").first().html($.i18n.t("DNEControl.form.ResourceTypeId")),$("#"+t+"Tbl").find("th[data-field='UpdateUserCode']").find("div").first().html($.i18n.t("DNEControl.form.UpdateUserCode")),$("#"+t+"Tbl").find("th[data-field='UpdateDate']").find("div").first().html($.i18n.t("DNEControl.form.UpdateDate")),$("#"+t+"Tbl").find("th[data-field='CreatorUserCode']").find("div").first().html($.i18n.t("DNEControl.form.CreatorUserCode")),$("#"+t+"Tbl").find("th[data-field='CreationDate']").find("div").first().html($.i18n.t("DNEControl.form.CreationDate")),$("#"+t+"Tbl").find("th[data-field='Download']").find("div").first().html($.i18n.t("DNEControl.form.Download")),$("#"+t+"CreateBtn").append(" "+$.i18n.t("DNEControl.form.Add")),$("#"+t+"RefreshBtn").append(" "+$.i18n.t("DNEControl.form.Refresh")),$("#"+t+"SignatureWrapper").find("h1").append(" "+$.i18n.t("DNEControl.form.ESignature")),$("#"+t+"SignatureWrapper").find("p").append(" "+$.i18n.t("DNEControl.form.ESignature-description")),$("#"+t+"Signature-add").append(" "+$.i18n.t("DNEControl.form.ESignature-add")),$("#"+t+"Signature-clear").append(" "+$.i18n.t("DNEControl.form.ESignature-clear")),document.getElementById(t+"CreateBtn").title=$.i18n.t("DNEControl.form.Add"),document.getElementById(t+"RefreshBtn").title=$.i18n.t("DNEControl.form.Refresh"),e?($("#"+t+"DeleteModal").find("h4.modal-title").html($.i18n.t("DNEControl.form.ConfirmElimination")),$("#"+t+"DeleteModal").find("p.error-text").html($.i18n.t("DNEControl.form.SureWantToEliminate")),$("#"+t+"DeleteModalBtn").append(" "+$.i18n.t("DNEControl.form.Delete")),document.getElementById(t+"DeleteModalBtn").title=$.i18n.t("DNEControl.form.Delete"),$("#"+t+"DeleteModal").find(".modal-footer").find(".btn").last().append(" "+$.i18n.t("DNEControl.form.Cancel")),$("#"+t+"AddModal").find("h4.modal-title").html($.i18n.t("DNEControl.form.Add")),$("#"+t+"AddModalDescriptionLabel").html($.i18n.t("DNEControl.form.Description")),document.getElementById(t+"AddModalDescription").title=$.i18n.t("DNEControl.form.Description"),$("#"+t+"AddModalBtn").append(" "+$.i18n.t("DNEControl.form.Save")),document.getElementById(t+"AddModalBtn").title=$.i18n.t("DNEControl.form.Save"),$("#"+t+"AddModal").find(".modal-footer").find(".btn").last().append(" "+$.i18n.t("DNEControl.form.Close")),$("#"+t+"EditModal").find("h4.modal-title").html($.i18n.t("DNEControl.form.Edit")),$("#"+t+"EditModalDescriptionLabel").html($.i18n.t("DNEControl.form.Description")),document.getElementById(t+"EditModalDescription").title=$.i18n.t("DNEControl.form.Description"),$("#"+t+"EditExpirationDateLabel").html($.i18n.t("DNEControl.form.ExpirationDate")),document.getElementById(t+"EditExpirationDate").title=$.i18n.t("DNEControl.form.ExpirationDate"),$("#"+t+"EditModalBtn").append(" "+$.i18n.t("DNEControl.form.Update")),document.getElementById(t+"EditModalBtn").title=$.i18n.t("DNEControl.form.Update"),$("#"+t+"EditModal").find(".modal-footer").find(".btn").last().append(" "+$.i18n.t("DNEControl.form.Close")),$("#"+t+"SeeModal").find("h4.modal-title").html($.i18n.t("DNEControl.form.FullNote")),$("#"+t+"SeeModal").find(".modal-footer").find(".btn").last().append(" "+$.i18n.t("DNEControl.form.Close"))):($("#"+t+"RemoveBtn").append(" "+$.i18n.t("DNEControl.form.Delete")),document.getElementById(t+"RemoveBtn").title=$.i18n.t("DNEControl.form.Delete"),$("#"+t+"Delete").find("h4.modal-title").html($.i18n.t("DNEControl.form.ConfirmElimination")),$("#"+t+"Delete").find("p.error-text").html($.i18n.t("DNEControl.form.SureWantToEliminate")),$("#"+t+"DeleteAction").append(" "+$.i18n.t("DNEControl.form.Delete")),document.getElementById(t+"DeleteAction").title=$.i18n.t("DNEControl.form.Delete"),$("#"+t+"Delete").find(".modal-footer").find(".btn").last().append(" "+$.i18n.t("DNEControl.form.Cancel")),$("#"+t+"AddModal").find("h4.modal-title").html($.i18n.t("DNEControl.form.Add")),$("#"+t+"AddForm").find("#"+t+"DNEFileDescriptionLabel").html($.i18n.t("DNEControl.form.Description")),document.getElementById(t+"DNEFileDescription").title=$.i18n.t("DNEControl.form.Description"),$("#"+t+"AddForm").find("#"+t+"DNEFileExpirationDateLabel").html($.i18n.t("DNEControl.form.ExpirationDate")),document.getElementById(t+"DNEFileExpirationDate").title=$.i18n.t("DNEControl.form.ExpirationDate"),$("#"+t+"AddForm").find("#"+t+"DNEFileInputLabel").html($.i18n.t("DNEControl.form.File")),$("#"+t+"AddModal").find(".modal-footer").find(".btn").last().append(" "+$.i18n.t("DNEControl.form.Close")),$("#"+t+"EditForm").find("h4.modal-title").html($.i18n.t("DNEControl.form.Detail")),$("#"+t+"EditFormDescriptionLabel").html($.i18n.t("DNEControl.form.Description")),document.getElementById(t+"EditFormDescription").title=$.i18n.t("DNEControl.form.Description"),$("#"+t+"EditFormUpdateUsercodeLabel").html($.i18n.t("DNEControl.form.UpdateUserName")),document.getElementById(t+"EditFormUpdateUsercode").title=$.i18n.t("DNEControl.form.UpdateUserName"),$("#"+t+"EditFormUpdateDateLabel").html($.i18n.t("DNEControl.form.UpdateDate")),document.getElementById(t+"EditFormUpdateDate").title=$.i18n.t("DNEControl.form.UpdateDate"),$("#"+t+"EditFormCreatorUsercodeLabel").html($.i18n.t("DNEControl.form.CreatorUserName")),document.getElementById(t+"EditFormCreatorUsercode").title=$.i18n.t("DNEControl.form.CreatorUserName"),$("#"+t+"EditFormCreationDateLabel").html($.i18n.t("DNEControl.form.CreationDate")),document.getElementById(t+"EditFormCreationDate").title=$.i18n.t("DNEControl.form.CreationDate"),$("#"+t+"EditFormExpirationDateLabel").html($.i18n.t("DNEControl.form.ExpirationDate")),document.getElementById(t+"EditFormExpirationDate").title=$.i18n.t("DNEControl.form.ExpirationDate"),$("#"+t+"SaveEditForm").append(" "+$.i18n.t("DNEControl.form.Update")),document.getElementById(t+"SaveEditForm").title=$.i18n.t("DNEControl.form.Update"),$("#"+t+"EditForm").find(".modal-footer").find(".btn").last().append(" "+$.i18n.t("DNEControl.form.Close")))},this.LoadDefaultValues=function(t,e,o,r,a,d,l,s,p){$("#"+t+"SequenceId").val(e),$("#"+t+"SequenceId").data("isTemporary",a),$("#"+t+"AddModalDescription, #"+t+"EditModalDescription, #"+t+"EditFormDescription").attr("maxlength","100"),$("#"+t+"EditFormExpirationDate-group, #"+t+"DNEFileExpirationDate-group, #"+t+"EditExpirationDate-group").datetimepicker({format:generalSupport.DateFormat(),locale:generalSupport.LanguageName()}),DNESupport.DNERetrieveData(t,r,o,a).done(function(){if(DNESupport.DNERefreshButtonEvent(t,r,o,a),r){if(DNESupport.DNEAddNoteEvent(t,o,a),0===n){DNESupport.LoadTextOnForm(t,!0);var e=DNESupport.GetExpirationDateOnAdd(t);$("#"+t+"AddForm").find(".row").find(".col-md-12").first().after(e),$("#"+t+"AddModalExpirationDate-group").datetimepicker({format:generalSupport.DateFormat(),locale:generalSupport.LanguageName()}),n++}DNESupport.DNENotesVisible(t,l),DNESupport.DNENotesEnable(t,s)}else(d||0===i)&&(DNESupport.DNEGridEvents(t,!0,a),DNESupport.LoadTextOnForm(t,!1)),0!==i||d||(DNESupport.DNEGridEvents(t,!0,a),i++),DNESupport.DNEFileEventInitialization(t,o,a),DNESupport.DNEAttachmentsVisible(t,l),DNESupport.DNEAttachmentsEnable(t,s);DNESupport.initializeSignature(t,o,a,p)})},this.DNEInitialization=function(t,e,o,n,i,a,d,l,s,p){s=null==s||s,p=null!=(l=null==l||l)&&p,0===r?$.when(DNESupport.DNEGetProvider(),DNESupport.DNEGetUrl(),DNESupport.DNEIsUserSuscriptor(),$.ajax("/fasi/locales/DNEControlBase."+generalSupport.LanguageName()+".json")).done(function(a,u,c,D){$.i18n.addResourceBundle(generalSupport.LanguageName(),"translation",D[0],!0,!0),DNESupport.LoadDefaultValues(t,e,o,n,i,d,l,s,p),r++}):DNESupport.LoadDefaultValues(t,e,o,n,i,d,l,s,p)},this.GetExpirationDateOnAdd=function(t){return'<div class="col-md-12"><div class="form-group"><div class="col-md-4 text-left"><label id="'+t+'AddModalExpirationDateLabel" class="control-label"for="'+t+'AddModalExpirationDate">'+$.i18n.t("DNEControl.form.ExpirationDate")+'</label></div><div class="col-md-8"><div class="input-group date" id="'+t+'AddModalExpirationDate-group"><input id="'+t+'AddModalExpirationDate" name="'+t+'AddModalExpirationDate"type="text" class="form-control" size="10" maxlength="10" title="'+$.i18n.t("DNEControl.form.ExpirationDate")+'"><span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span></div></div></div></div>'},this.DNEGridEvents=function(t,e,o){var n=$("#"+t+"Tbl");n.bootstrapTable().off(),e?(n.on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(e,o){$("#"+t+"RemoveBtn").prop("disabled",!n.bootstrapTable("getSelections").length)}).on("click-cell.bs.table",function(t,e,o,n){"Download"===e&&DNESupport.DNERequestResourceContent(n)}),$("#"+t+"Delete").find("#"+t+"DeleteAction").off().click(function(e){DNESupport.DNEDeleteResourceFromTable(t,o),e.preventDefault()}),$("#"+t+"RemoveBtn").prop("disabled",!n.bootstrapTable("getSelections").length)):$("#"+t+"Delete").find("#"+t+"DeleteAction").off(),n.on("click-cell.bs.table",function(e,o,n,i){"Name"===o&&DNESupport.DNEEditResourceEvent(t,i)})},this.DNEGetDeleteOperation=function(t){return!0===t?"DeleteResourceTemporarily":"DeleteResource"},this.DNEGetAddOperation=function(t){return!0===t?"AddResourceWithTemporaryState":"AddResource"},this.DNEGetRetrieveOperation=function(e){return t?"GetActiveResourceSequenceAndMyTemporals":!0===e?"GetOwnResourceSequenceTemporaryStateOnly":"GetOwnResourceSequenceActiveAndTemporaryState"},this.DNEFileEventInitialization=function(t,o,n){var i=$("#"+t+"DNEFileInput");i.off().fileinput("destroy").fileinput({uploadUrl:"/fasi/handlers/DNEUploadFileHandler.ashx",language:generalSupport.LanguageName(),maxFileCount:5,fileActionSettings:{showRemove:!1,showUpload:!0,showDownload:!0,showZoom:!1,showDrag:!1},uploadExtraData:function(){return{selector:t,description:$("#"+t+"DNEFileDescription").val(),expirationDate:$("#"+t+"DNEFileExpirationDate").val(),sequenceId:$("#"+t+"SequenceId").val(),tags:JSON.stringify(o),operationName:DNESupport.DNEGetAddOperation(n),provider:e,token:app.user.token,formatDate:generalSupport.DateFormat(),extensionNotAllowedMessage:$.i18n.t("DNEControl.validation.ExtensionNotAllowed"),expirationDateErrorMessage:$.i18n.t("DNEControl.validation.InvalidExpirationDate")}}}).on("filepreajax",function(t,e,o){}).on("fileuploaded",function(e,o,n,r){1===o.filescount&&(i.fileinput("refresh").fileinput("enable").fileinput("clear"),$("#"+t+"DNEFileDescription").val(""),$("#"+t+"DNEFileExpirationDate").val(""));var a=$("#"+t+"SequenceId");"0"===a.val().toString()&&a.val(o.response.id),DNESupport.DNERefreshGrid(t)}).on("fileerror",function(t,e,o){})},this.DNEDeleteResourceFromTable=function(t,e){var o=$.map($("#"+t+"Tbl").bootstrapTable("getSelections"),function(t){return{SequenceId:t.SequenceId,ConsequenceId:t.ConsequenceId}}),n=DNESupport.DNEGetDeleteOperation(e);$.each(o,function(e,o){DNESupport.DNEDeleteResource(o,n).done(function(e){DNESupport.DNERefreshGrid(t)})}),$("#"+t+"Btn").prop("disabled",!0)},this.DNEAddResource=function(t,n,i){return $.LoadingOverlay("show"),$.ajax({type:"POST",url:o+i,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({resource:n,provider:e}),beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+app.user.token)},success:function(t){},error:function(t,e,o){generalSupport.ErrorHandler(t,e,o)},complete:function(){$.LoadingOverlay("hide")}})},this.DNEDeleteResource=function(t,n){return $.LoadingOverlay("show"),$.ajax({type:"POST",url:o+n,contentType:"application/json; charset=utf-8",data:JSON.stringify({composedResourceKey:t,provider:e}),beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+app.user.token)},success:function(){},error:function(t,e,o){toastr.error($.i18n.t("DNEControl.form.AccessDenied"),"",{positionClass:"toast-bottom-right"})},complete:function(){$.LoadingOverlay("hide")}})},this.DNERequestResourceContent=function(t){var n={SequenceId:t.SequenceId,ConsequenceId:t.ConsequenceId};$.LoadingOverlay("show"),$.ajax({type:"POST",url:o+"GetResourceContent",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({composedResourceKey:n,provider:e}),beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+app.user.token)},success:function(e){DNESupport.DNEDownloadFile(e,t.Name)},error:function(t,e,o){generalSupport.ErrorHandler(t,e,o)},complete:function(){$.LoadingOverlay("hide")}})},this.DNEEditResourceEvent=function(t,e){var o=$("#"+t+"EditForm");o.find("#"+t+"EditFormDescription").val(e.Description),o.find("#"+t+"EditFormUpdateUsercode").val(e.UpdateUserName).attr("disabled",!0),o.find("#"+t+"EditFormCreatorUsercode").val(e.CreatorUserName).attr("disabled",!0),o.find("#"+t+"EditFormUpdateDate").val(null!==e.UpdateDate?generalSupport.ToJavaScriptDateCustom(e.UpdateDate,generalSupport.DateFormat()):"").attr("disabled",!0),o.find("#"+t+"EditFormCreationDate").val(null!==e.CreationDate?generalSupport.ToJavaScriptDateCustom(e.CreationDate,generalSupport.DateFormat()):"").attr("disabled",!0),o.find("#"+t+"EditFormExpirationDate").val(null!==e.ExpirationDate?generalSupport.ToJavaScriptDateCustom(e.ExpirationDate,generalSupport.DateFormat()):""),o.modal("show").on("hidden.bs.modal",function(e){$("#"+t+"SaveEditForm").off()}),$("#"+t+"SaveEditForm").off().click(function(n){e.Description=$("#"+t+"EditFormDescription").val();var i=$("#"+t+"EditFormExpirationDate").val();""===e.Description?toastr.error($.i18n.t("DNEControl.validation.DescriptionCannotBeEmpty"),"",{positionClass:"toast-bottom-right"}):e.Description.length>100?toastr.error($.i18n.t("DNEControl.validation.DescriptionCannotBeEmpty"),"",{positionClass:"toast-bottom-right"}):""===i||moment(i,generalSupport.DateFormat()).isAfter(moment(new Date))?(e.ExpirationDate=""!==i?generalSupport.jsDateToWCF(i,generalSupport.DateFormat()):null,DNESupport.DNEEditResource(e).done(function(){DNESupport.DNERefreshGrid(t),o.modal("hide")})):toastr.error($.i18n.t("DNEControl.validation.InvalidExpirationDate"),"",{positionClass:"toast-bottom-right"})})},this.DNEEditResource=function(t){return $.LoadingOverlay("show"),$.ajax({type:"POST",url:o+"UpdateResource",contentType:"application/json; charset=utf-8",data:JSON.stringify({updatedResourceDTO:t,provider:e}),beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+app.user.token)},success:function(){},error:function(t,e,o){toastr.error($.i18n.t("DNEControl.form.AccessDenied"),"",{positionClass:"toast-bottom-right"})},complete:function(){$.LoadingOverlay("hide")}})},this.DNERefreshGrid=function(t){$("#"+t+"RefreshBtn").click()},this.DNENotesRequired=function(t,e){return!e||($("#"+t+"NoteList").find(".note").length>=1||(swal($.i18n.t("DNEControl.form.ErrorForm"),$.i18n.t("DNEControl.form.NoteRequired"),$.i18n.t("DNEControl.form.Error")),!1))},this.DNENotesVisible=function(t,e){e?$("#"+t+"NoteList").parent().show():$("#"+t+"NoteList").parent().hide()},this.DNENotesEnable=function(t,e){e?($("#"+t+"NoteList").parent().find(".btn, a").attr("disabled",!1),$("."+t+"NoteDelete").attr("disabled",!1)):($("#"+t+"NoteList").parent().find(".btn, a").attr("disabled",!0),$("#"+t+"Tbl").off()),$("#"+t+"SeeModal").find(".btn.btn-default").attr("disabled",!1),$("."+t+"NoteSee").attr("disabled",!1)},this.DNEAttachmentsRequired=function(t,e){},this.DNEAttachmentsVisible=function(t,e){e?$("#"+t+"toolbar").parent().parent().parent().show():$("#"+t+"toolbar").parent().parent().parent().hide()},this.DNEAttachmentsEnable=function(t,e,o){var n;(void 0===o&&(o=$("#"+t+"SequenceId").data("isTemporary")),e)?($("#"+t+"toolbar").parent().parent().parent().find(".btn, a, i").attr("disabled",!1),DNESupport.DNEGridEvents(t,!0,o),(n=$("#"+t+"EditForm")).find("#"+t+"EditFormDescription").attr("disabled",!1),n.find("#"+t+"EditFormExpirationDate").attr("disabled",!1),n.find("#"+t+"SaveEditForm").attr("disabled",!1)):($("#"+t+"toolbar").parent().parent().parent().find(".btn, a, i").attr("disabled",!0),DNESupport.DNEGridEvents(t,!1,o),(n=$("#"+t+"EditForm")).find("#"+t+"EditFormDescription").attr("disabled",!0),n.find("#"+t+"EditFormExpirationDate").attr("disabled",!0),n.find("#"+t+"SaveEditForm").attr("disabled",!0))},this.DNEGetTags=function(){},this.base64ToArrayBuffer=function(t){for(var e=window.atob(t),o=e.length,n=new Uint8Array(o),i=0;i<o;i++)n[i]=e.charCodeAt(i);return n},this.initializeSignature=function(t,e,o,n){if(n){$("#"+t+"SignatureWrapper").show(),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimaitonFrame||function(t){window.setTimeout(t,1e3/60)};var i=document.getElementById(t+"Signature-canvas");i.width="620",i.height="160";var r=i.getContext("2d");r.strokeStyle="#222222",r.lineWidth=4;var a=!1,d={x:0,y:0},l=d;function s(t,e){var o=t.getBoundingClientRect();return{x:e.clientX-o.left,y:e.clientY-o.top}}i.addEventListener("mousedown",function(t){a=!0,l=s(i,t)},!1),i.addEventListener("mouseup",function(t){a=!1},!1),i.addEventListener("mousemove",function(t){d=s(i,t)},!1),i.addEventListener("touchstart",function(t){},!1),i.addEventListener("touchmove",function(t){var e=t.touches[0],o=new MouseEvent("mousemove",{clientX:e.clientX,clientY:e.clientY});i.dispatchEvent(o)},!1),i.addEventListener("touchstart",function(t){var e,o;e=t,o=i.getBoundingClientRect(),d={x:e.touches[0].clientX-o.left,y:e.touches[0].clientY-o.top};var n=t.touches[0],r=new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});i.dispatchEvent(r)},!1),i.addEventListener("touchend",function(t){var e=new MouseEvent("mouseup",{});i.dispatchEvent(e)},!1),document.body.addEventListener("touchstart",function(t){t.target==i&&t.preventDefault()},!1),document.body.addEventListener("touchend",function(t){t.target==i&&t.preventDefault()},!1),document.body.addEventListener("touchmove",function(t){t.target==i&&t.preventDefault()},!1),function t(){requestAnimFrame(t),a&&(r.moveTo(l.x,l.y),r.lineTo(d.x,d.y),r.stroke(),l=d)}();var p=document.getElementById(t+"Signature-add");document.getElementById(t+"Signature-clear").addEventListener("click",function(t){i.width=i.width},!1),p.addEventListener("click",function(n){DNESupport.addSignatureToDNE(t,i.toDataURL(),e,o)},!1),$("#"+t+"Signature-canvas").css({border:"2px dotted #CCCCCC","border-radius":"15px",cursor:"crosshair"})}else $("#"+t+"SignatureWrapper").hide()},this.addSignatureToDNE=function(t,e,o,n){var i=$("#"+t+"SequenceId").val(),r={SequenceId:i,OriginalImage:Array.from(DNESupport.base64ToArrayBuffer(e.replace("data:image/png;base64,","")))},a={SequenceId:i,Description:"E-Signature",ResourceTypeId:1,ClientAssociatedCompany:"1",ClientAssociatedPerson:"1",Name:"E-Signature.png",Tags:o,Image:r,ExpirationDate:null};"0"!==i.toString()?DNESupport.DNEAddResource(t,a,DNESupport.DNEGetAddOperation(n)).done(function(){DNESupport.DNERefreshGrid(t)}):DNESupport.DNEGetSequenceId(t).done(function(e){r.SequenceId=e,a.SequenceId=e,DNESupport.DNEAddResource(t,a,DNESupport.DNEGetAddOperation(n)).done(function(){DNESupport.DNERefreshGrid(t)})})}};